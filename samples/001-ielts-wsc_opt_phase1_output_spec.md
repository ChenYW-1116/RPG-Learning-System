IELTS 寫作衝刺教練功能描述

程式需求描述

這是一個專業級的雅思（IELTS）寫作衝刺教練單頁應用程式（SPA），採用現代的藍色系主題，支援深色模式，旨在通過定時寫作、強制詞彙使用、被動語態分析和AI輔助工具來系統性地提升用戶的寫作能力。

🎯 核心功能需求

📝 寫作衝刺系統 (US-1: 5-Day Verb Sprint)

*   **定時器規格 (T007):** 固定的 15 分鐘 (900 秒) 倒計時。
*   **計時控制:** 提供開始 (`Start Verb Sprint`)、暫停 (`Pause`) 和繼續 (`Resume`) 三種控制按鈕。
*   **狀態顯示:** 即時顯示剩餘時間 (MM:SS 格式，使用等寬數字字體 `tabular-nums`) 和當前狀態（準備、衝刺中、已暫停、時間到）。
*   **編輯器鎖定:** 時間結束或提交後，寫作輸入框 (`#essay-input`) 將被禁用。
*   **每日任務生成 (T006):**
    *   基於日期檢查，每日生成一個新任務。
    *   任務包含一個雅思寫作主題和 6 個必用動詞。
    *   **動詞追蹤 (A2):** 系統會追蹤用戶歷史上已使用的動詞，並優先分配未曾使用過的新動詞。
*   **即時反饋:**
    *   即時計算並顯示字數 (`Word Count`)。
    *   即時顯示本地模擬的被動語態比例 (`Passive Ratio Mock`)。
    *   必用動詞列表即時更新使用狀態（⬜/✅）。
*   **提交驗證:** 提交前強制檢查作文中是否使用了所有 6 個必用動詞。
*   **AI 分析集成 (T009, T015):** 提交成功後，調用 AI 服務進行深度分析，包括：
    *   計算精確的被動語態比例。
    *   識別並列出作文中的被動句。
    *   識別並列出高級動詞及其含義。
    *   提供預估的雅思分數。
*   **歷史記錄保存:** 將衝刺結果（字數、時間、被動率、分數）保存到本地歷史記錄。

🧠 盲寫回譯系統 (US-2: Blind Write-back)

*   **原文來源 (T012):** 載入上次成功提交的衝刺作文作為原文。
*   **遮罩機制:** 原文顯示區域初始時被 95% 透明度的深色遮罩覆蓋，要求用戶點擊 (`Click to reveal and grade`) 後才能揭示原文。
*   **回寫輸入:** 用戶在單獨的文本框中憑記憶進行回寫。
*   **評估機制 (T013):**
    *   使用簡化的詞級別比對算法來計算「遺漏率 (Omission Rate)」。
    *   將原文中與用戶嘗試不匹配的單詞標記為遺漏（紅色背景、下劃線）。
    *   **通過標準 (B1):** 遺漏率低於 2% 被視為優秀表現。
*   **AI 診斷 (ai-blind-write-diagnosis):** 評估完成後，調用 AI 對比對結果進行簡短的語法或詞彙錯誤診斷（限制在 50 字內）。

🤖 AI 寫作工具 (US-3: AI Tools)

*   **AI 靈感助手 (ai-inspiration-generator):**
    *   功能：根據用戶輸入的作文題目，生成 3 個正面觀點、3 個反面觀點和 5 個學術詞彙。
    *   輸出格式：結構化的 JSON。
*   **文章分析器 (ai-essay-analyzer):**
    *   功能：接收用戶貼上的作文，進行語法和詞彙分析。
    *   輸出格式：結構化的 JSON，包含被動句、高級詞彙和預估分數。
*   **高階改寫器 (ai-essay-rewriter):**
    *   功能：接收用戶貼上的作文，將其改寫成 Band 9 級別的範文。
    *   輸出格式：純文本。
*   **API 基礎:** 所有 AI 服務均使用 `GeminiAPIWrapper` 類，該類內建指數退避重試機制，以提高調用成功率。

📊 進度報告 (US-4: Progress Report)

*   **歷史記錄:** 顯示最近 10 次練習的記錄表格，包括日期、遺漏率和被動語態比例。
*   **瓶頸指數 (T016 Mock):**
    *   計算基於歷史數據的複合弱點分數（高遺漏率和低被動語態比例會提高分數）。
    *   提供分數展示和模擬的 AI 提升建議列表。
    *   包含一個雷達圖可視化佔位符。

🎨 視覺設計規格

🌈 色彩方案

*   **主色調 (Primary):** 藍色系 (`#1d4ed8`, Tailwind `blue-700`)。
*   **深色模式主色調:** 淺藍色系 (`#93c5fd`, Tailwind `blue-300`)。
*   **背景色 (淺色):** 極淺灰 (`#f9fafb`, Tailwind `gray-50`)。
*   **背景色 (深色):** 深灰 (`#111827`, Tailwind `gray-900`)。
*   **文字顏色:** 淺色模式為深灰 (`gray-800`)，深色模式為極淺灰 (`gray-100`)。
*   **計時器強調色:** 紅色系 (`#dc2626`, Tailwind `red-600`)。
*   **遺漏標記色:** 紅色背景 (`#fecaca`, Tailwind `red-200`)，深紅色文字 (`#b91c1c`, Tailwind `red-700`)。
*   **AI 靈感區漸層:** 藍色到靛藍色漸層 (`from-blue-600 to-indigo-700`)。

🎭 背景設計

*   應用程式主體背景支援深色/淺色模式平滑過渡 (`transition: background-color 0.3s`)。
*   導航欄 (`nav`) 採用固定定位 (`sticky top-0`)，並帶有陰影 (`shadow-md`) 和高 Z 軸層級 (`z-40`)。

📦 容器規格

主容器

*   最大寬度：1280px (Tailwind `max-w-7xl`)。
*   定位：居中對齊 (`mx-auto`)。
*   內距：上下 6rem，左右 1.5rem (sm:px-6, lg:px-8)。

卡片容器 (通用)

*   背景：白色 (`bg-white`) / 深灰 (`dark:bg-gray-800`)。
*   圓角：大圓角 (`rounded-2xl`)。
*   邊框：淺灰邊框 (`border border-gray-200`)。
*   陰影：中等陰影 (`shadow-lg`)。

標籤導航

*   樣式：底部邊框分隔，選中標籤使用藍色底部邊框 (`border-b-2 border-blue-600`)。

🔘 按鈕設計

主要按鈕 (Start/Submit)

*   背景：實色藍色/綠色 (`bg-blue-600` / `bg-green-600`)。
*   文字：白色粗體。
*   圓角：大圓角 (`rounded-xl`)。
*   懸停效果：顏色變深 (`hover:bg-blue-700`)。
*   禁用狀態：灰色背景 (`disabled:bg-gray-400`)。
*   **加載動畫:** 內嵌旋轉加載器 (`loader`)，在處理期間禁用按鈕。

AI 輔助按鈕 (Analyze/Rewrite)

*   樣式：淺色背景，深色文字，帶邊框。
*   Analyze: 淺藍色背景 (`bg-blue-50`)，藍色邊框 (`border-blue-200`)。
*   Rewrite: 淺靛藍色背景 (`bg-indigo-50`)，靛藍色邊框 (`border-indigo-200`)。

📝 輸入框設計

*   內距：1rem (`p-4`)。
*   邊框：淺灰邊框 (`border border-gray-300`)。
*   圓角：中等圓角 (`rounded-lg`)。
*   背景：白色 (`bg-white`) / 深灰 (`dark:bg-gray-700`)。
*   文字：深灰 / 淺灰。
*   焦點效果：藍色環形陰影和邊框 (`focus:ring-blue-500 focus:border-blue-500`)。

🎪 彈窗規格 (Settings Modal)

*   背景遮罩：固定定位，黑色 75% 透明度 (`bg-gray-900 bg-opacity-75`)。
*   內容區域：最大寬度 512px (`max-w-lg`)。
*   圓角：中等圓角 (`rounded-xl`)。
*   陰影：極大陰影 (`shadow-2xl`)。
*   內部按鈕：藍色實色背景，大圓角。
*   數據清除按鈕：紅色警告樣式 (`bg-red-100 text-red-700`)。

📱 響應式設計

桌面版（>1024px）

*   **US-1 Sprint:** 兩欄佈局，左側佔 1/3，右側寫作區佔 2/3 (`lg:grid-cols-3` with `lg:col-span-1` and `lg:col-span-2`)。
*   **US-2 Blind:** 兩欄佈局，各佔 1/2 (`lg:grid-cols-2`)。
*   **US-4 Report:** 兩欄佈局，左側圖表佔 2/3，右側歷史佔 1/3 (`lg:grid-cols-3` with `lg:col-span-2` and `lg:col-span-1`)。

手機版（≤1024px）

*   所有網格佈局均退化為單欄垂直堆疊 (`grid-cols-1`)。

🔧 技術特色

國際化 (I18N)

*   **語言支持 (T004):** 內建繁體中文 (`zh`) 和英文 (`en`) 翻譯字典。
*   **實現方式:** 使用 `data-i18n` 屬性標記 UI 元素，通過 JavaScript 函數 `applyTranslations()` 進行動態替換。

狀態管理與持久化 (T005)

*   **存儲機制:** 使用 `localStorage` 存儲應用程式狀態 (`IELTS_COACH_STATE_V2`)。
*   **保存內容:** 包含用戶設定（語言、API Key、深色模式）、當前任務進度、歷史記錄、計時器狀態等。

API 服務層

*   **API Wrapper:** `GeminiAPIWrapper` 類封裝了對 Gemini API 的調用邏輯。
*   **健壯性:** 內建指數退避重試機制 (`retryDelays: [1000, 2000, 4000]`)，以處理暫時性 API 錯誤。
*   **JSON 處理:** 支援結構化 JSON 輸出，並自動清理 Markdown 圍欄。

核心算法

*   **遺漏率計算 (T013):** `calculateOmissionPercentage` 函數通過詞彙級別的比對，計算遺漏的單詞數量與原文總詞數的比例。
*   **UI Hardening:** 採用 `performAction` 函數作為異步操作的守衛，確保操作期間 UI 鎖定 (`isProcessing`)，並統一處理加載器和錯誤提示 (`showToast`)。