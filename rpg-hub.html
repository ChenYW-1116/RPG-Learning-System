<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest Empire - æŒ‘æˆ°è€…æˆé•·å¹³å°</title>
    <meta name="description" content="é€éæŒ‘æˆ°ç«¶æŠ€å ´ç²å¾—ä»£å¹£èˆ‡ç¶“é©—å€¼ï¼Œè§£é–å·¥å…·ï¼Œåˆ†äº«æˆé•·æ­·ç¨‹">
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0F0F1A 0%, #1A1A2E 50%, #0F0F1A 100%);
            min-height: 100vh;
            color: #E2E8F0;
        }

        .title-glow {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(90deg, #6366F1, #8B5CF6, #EC4899, #F59E0B, #10B981, #6366F1);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleShimmer 5s linear infinite;
        }

        @keyframes titleShimmer {
            0% {
                background-position: 0% 50%;
            }

            100% {
                background-position: 300% 50%;
            }
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border: 1px solid rgba(99, 102, 241, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 16px;
        }

        .stat-box {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-4px);
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 700;
        }

        .xp-bar-container {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 3px;
        }

        .xp-bar {
            height: 16px;
            border-radius: 10px;
            background: linear-gradient(90deg, #6366F1, #8B5CF6, #EC4899);
            background-size: 200% 100%;
            animation: xpGlow 2s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes xpGlow {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        .arena-card {
            background: linear-gradient(145deg, rgba(127, 29, 29, 0.3), rgba(30, 41, 59, 0.8));
            border: 2px solid #EF4444;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .arena-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 40px rgba(239, 68, 68, 0.3);
        }

        .arena-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 0%, rgba(239, 68, 68, 0.15), transparent 60%);
        }

        .battle-record {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid;
            border-radius: 0 12px 12px 0;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .battle-record.victory {
            border-left-color: #10B981;
        }

        .battle-record.defeat {
            border-left-color: #EF4444;
        }

        .plugin-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .plugin-card:hover {
            transform: translateY(-4px) scale(1.02);
        }

        .plugin-card.owned {
            border-color: #10B981;
        }

        .tier-badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 10px;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-arena {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.4);
        }

        .btn-arena:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.6);
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #94A3B8;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #6366F1;
            border-bottom-color: #6366F1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1A1A2E;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #6366F1, #8B5CF6);
            border-radius: 4px;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        /* Tool Store Styles */
        .category-filter {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #94A3B8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-filter:hover {
            border-color: rgba(99, 102, 241, 0.5);
            color: #E2E8F0;
        }

        .category-filter.active {
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
            border-color: transparent;
            color: white;
        }

        .tool-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .tool-card:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.15);
        }

        .tool-card.owned {
            border-color: #10B981;
        }

        .tool-card.owned::after {
            content: 'âœ“ å·²æ“æœ‰';
            position: absolute;
            top: 12px;
            right: 12px;
            background: #10B981;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .equipment-card {
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.1), rgba(30, 41, 59, 0.9));
            border: 2px solid #10B981;
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .equipment-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(16, 185, 129, 0.3);
        }

        .feature-tag {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 10px;
            font-size: 10px;
            color: #A5B4FC;
            margin-right: 4px;
            margin-bottom: 4px;
        }

        .rating-stars {
            color: #FBBF24;
            font-size: 12px;
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <!-- Language Toggle -->
    <div class="fixed bottom-6 right-6 z-50">
        <button id="langToggleBtn" type="button" onclick="toggleLanguage()"
            class="bg-slate-700/80 hover:bg-slate-600 backdrop-blur-md text-gray-300 text-sm py-2 px-4 rounded-full border border-slate-600 shadow-2xl transition flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
            </svg>
            <span id="langBtnText">EN</span>
        </button>
    </div>

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="title-glow text-4xl md:text-5xl font-black mb-2 tracking-wider" data-i18n="mainTitle">QUEST
                EMPIRE</h1>
            <p class="text-gray-400" data-i18n="subTitle">ğŸ® æŒ‘æˆ°è€…æˆé•·å¹³å° â€” é€éç«¶æŠ€å ´æŒ‘æˆ°ç²å¾—ä»£å¹£èˆ‡ç¶“é©—å€¼</p>
        </header>

        <!-- Player Status -->
        <section class="glass-card p-6 mb-6">
            <div class="flex flex-col md:flex-row items-center gap-6">
                <div class="text-center">
                    <div id="rank-icon" class="text-6xl mb-2">ğŸŒ±</div>
                    <div id="rank-title" class="text-lg font-bold text-indigo-400">æ–°æ‰‹æŒ‘æˆ°è€…</div>
                    <div class="text-sm text-gray-500">Lv.<span id="player-level">1</span></div>
                </div>
                <div class="flex-1 w-full">
                    <div class="flex justify-between items-end mb-2">
                        <div>
                            <span class="text-sm text-gray-400" data-i18n="totalXP">ç¸½ç¶“é©—å€¼</span>
                            <div class="text-2xl font-bold text-yellow-400 font-['Orbitron']"><span
                                    id="total-xp">0</span> XP</div>
                        </div>
                        <div class="text-right">
                            <span class="text-sm text-gray-400" data-i18n="tokens">ğŸ’° ä»£å¹£</span>
                            <div class="text-2xl font-bold text-amber-400 font-['Orbitron']"><span
                                    id="total-tokens">0</span></div>
                        </div>
                    </div>
                    <div class="xp-bar-container">
                        <div class="xp-bar" id="xp-bar" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-gray-500">
                        <span><span id="xp-current">0</span> / <span id="xp-total">150</span></span>
                        <span id="xp-needed-container">é‚„éœ€ <span id="xp-needed" class="text-indigo-400">150</span> XP
                            å‡ç´š</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="stat-box">
                        <div class="stat-value text-green-400" id="stat-victories">0</div>
                        <div class="text-xs text-gray-400" data-i18n="victories">å‹åˆ©å ´æ¬¡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value text-red-400" id="stat-defeats">0</div>
                        <div class="text-xs text-gray-400" data-i18n="defeats">å¤±æ•—å ´æ¬¡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value text-purple-400" id="plugins-count">0</div>
                        <div class="text-xs text-gray-400" data-i18n="unlockedTools">å·²è§£é–å·¥å…·</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value text-orange-400" id="streak-days">0</div>
                        <div class="text-xs text-gray-400" data-i18n="streakDays">é€£çºŒå¤©æ•¸</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- API Key Settings -->
        <section class="glass-card p-4 mb-6">
            <div id="gemini-key-container">
                <!-- Will be populated by GeminiKeyManager.renderInputUI() -->
            </div>
        </section>

        <!-- Main Arena Entry -->
        <section class="arena-card mb-8" onclick="window.location.href='ielts_challenger_arena.html'">
            <div class="relative z-10 flex flex-col md:flex-row items-center gap-6">
                <div class="text-7xl animate-pulse">âš”ï¸</div>
                <div class="flex-1 text-center md:text-left">
                    <h2 class="text-2xl font-bold text-red-400 mb-2" data-i18n="arenaTitle">æŒ‘æˆ°è€…ç«¶æŠ€å ´</h2>
                    <p class="text-gray-300 mb-4" data-i18n="arenaDesc">æäº¤ä½œæ–‡æŒ‘æˆ°ä½ çš„å¼±é» Bossï¼AI æœƒè‡ªå‹•è©•ä¼°ä¸¦åˆ¤å®šå‹æ•—ã€‚</p>
                    <div class="flex flex-wrap gap-4 justify-center md:justify-start">
                        <div class="text-sm"><span class="text-green-400 font-bold" data-i18n="arenaRewardWin">âœ… å‹åˆ© = XP
                                + ä»£å¹£</span></div>
                        <div class="text-sm"><span class="text-yellow-400 font-bold" data-i18n="arenaRewardReview">ğŸ“ æª¢è¨
                                = é¡å¤– XP åŠ æˆ</span></div>
                        <div class="text-sm"><span class="text-purple-400 font-bold" data-i18n="arenaRewardUnlock">ğŸ”“ è§£é–
                                = ä½¿ç”¨ä»£å¹£æ› Plugin</span></div>
                    </div>
                </div>
                <button class="btn-arena" data-i18n="arenaBtn">é€²å…¥ç«¶æŠ€å ´ â†’</button>
            </div>
        </section>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-700 mb-6 overflow-x-auto">
            <button class="tab-btn active" data-tab="battles" data-i18n="tabBattles">ğŸ“œ æˆ°é¬¥ç´€éŒ„</button>
            <button class="tab-btn" data-tab="tools" data-i18n="tabTools">ğŸ§° å·¥å…·å•†åº—</button>
            <button class="tab-btn" data-tab="equipment" data-i18n="tabEquip">ğŸ’ æˆ‘çš„è£å‚™</button>
            <button class="tab-btn" data-tab="upload-tool" data-i18n="tabUpload">ğŸ“¤ ä¸Šå‚³å·¥å…·</button>
            <button class="tab-btn" data-tab="plugins" data-i18n="tabPlugins">ğŸ”Œ æ•ˆæœå•†åº—</button>
            <button class="tab-btn" data-tab="achievements" data-i18n="tabAchieve">ğŸ† æˆå°±</button>
        </div>

        <!-- Tab Content: Battle History -->
        <div id="tab-battles" class="tab-content active">
            <h2 class="text-xl font-bold mb-4" data-i18n="logTitle">ğŸ“œ æœ€è¿‘æˆ°é¬¥ç´€éŒ„</h2>
            <div id="battle-history" class="space-y-4"></div>
        </div>

        <!-- Tab Content: Tools Store (HTML å·¥å…·å•†åº—) -->
        <div id="tab-tools" class="tab-content">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
                <div>
                    <h2 class="text-xl font-bold" data-i18n="storeTitle">ğŸ§° å·¥å…·å•†åº—</h2>
                    <p class="text-gray-400" data-i18n="storeDesc">ä½¿ç”¨ä»£å¹£å…Œæ›å¼·å¤§çš„ HTML å·¥å…·ï¼Œæå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼</p>
                </div>
                <div class="flex gap-2 flex-wrap">
                    <button class="category-filter active" data-category="all" data-i18n="catAll">å…¨éƒ¨</button>
                    <button class="category-filter" data-category="github" data-i18n="catGithub">ğŸ”§ GitHub</button>
                    <button class="category-filter" data-category="writing" data-i18n="catWriting">âœï¸ å¯«ä½œ</button>
                    <button class="category-filter" data-category="practice" data-i18n="catPractice">ğŸ¯ ç·´ç¿’</button>
                    <button class="category-filter" data-category="analysis" data-i18n="catAnalysis">ğŸ“Š åˆ†æ</button>
                </div>
            </div>
            <div id="tool-store" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
        </div>

        <!-- Tab Content: My Equipment (å€‹äººè£å‚™) -->
        <div id="tab-equipment" class="tab-content">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
                <div>
                    <h2 class="text-xl font-bold" data-i18n="equipTitle">ğŸ’ æˆ‘çš„è£å‚™</h2>
                    <p class="text-gray-400" data-i18n="equipDesc">é€™è£¡æ˜¯ä½ å·²å…Œæ›çš„å·¥å…·ï¼Œé»æ“Šå³å¯ä½¿ç”¨ï¼</p>
                </div>
                <div class="text-sm text-gray-500">
                    <span data-i18n="equipOwned">å·²æ“æœ‰</span> <span id="owned-tools-count"
                        class="text-purple-400 font-bold">0</span> <span data-i18n="equipUnit">å€‹å·¥å…·</span>
                </div>
            </div>
            <div id="my-equipment" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
            <div id="no-equipment" class="hidden text-center py-16">
                <div class="text-6xl mb-4">ğŸ’</div>
                <p class="text-gray-400 mb-2" data-i18n="equipEmpty">ä½ é‚„æ²’æœ‰ä»»ä½•è£å‚™</p>
                <p class="text-gray-500 text-sm" data-i18n="equipEmptyDesc">å‰å¾€å·¥å…·å•†åº—å…Œæ›ä½ çš„ç¬¬ä¸€å€‹å·¥å…·å§ï¼</p>
            </div>
        </div>

        <!-- Tab Content: Upload Tool (ä¸Šå‚³å·¥å…·) -->
        <div id="tab-upload-tool" class="tab-content">
            <div class="bg-blue-500/10 border border-blue-500/30 p-4 rounded-lg mb-6">
                <h3 class="font-bold text-blue-400 mb-2" data-i18n="uploadHeader">ğŸ’¡ ç©ºé–“åŒæ­¥æ¨¡å¼</h3>
                <p class="text-gray-300 text-sm mb-2" data-i18n="uploadHeaderDesc">ç¾åœ¨æ”¯æ´ç›´æ¥å°‡å·¥å…·ä¸Šå‚³è‡³ç³»çµ±ç©ºé–“ï¼</p>
                <ol class="list-decimal list-inside text-sm text-gray-400 space-y-1">
                    <li data-i18n="uploadStep1">é¸æ“‡ä½ çš„ HTML å·¥å…·æª”æ¡ˆï¼ˆç³»çµ±æœƒè‡ªå‹•å°‡å…¶åŒæ­¥åˆ° <code
                            class="bg-gray-800 px-1 py-0.5 rounded">tools/</code> ç©ºé–“ï¼‰ã€‚</li>
                    <li data-i18n="uploadStep2">å¡«å¯«å·¥å…·è³‡è¨Šå¾Œé»æ“Šä¸Šå‚³ã€‚</li>
                    <li data-i18n="uploadStep3">ä¸Šå‚³å¾Œï¼Œä½ å’Œå…¶ä»–ç©å®¶å³å¯ç›´æ¥å¾ç©ºé–“ä¸‹è¼‰ä¸¦ä½¿ç”¨è©²å·¥å…·ã€‚</li>
                </ol>
            </div>

            <div class="glass-card p-6 max-w-2xl">
                <div class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-i18n="toolName">å·¥å…·åç¨± *</label>
                            <input id="upload-tool-name" type="text" data-i18n-placeholder="placeholderToolName"
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white"
                                placeholder="ä¾‹ï¼šGitHub è‡ªå‹•æ¨é€åŠ©æ‰‹">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-i18n="toolFile">é¸æ“‡ HTML æª”æ¡ˆ *</label>
                            <div
                                class="flex items-center gap-3 bg-gray-800 border border-gray-700 rounded-lg px-4 py-2">
                                <button type="button" onclick="document.getElementById('upload-tool-file').click()"
                                    class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-semibold py-1.5 px-4 rounded-full transition whitespace-nowrap"
                                    data-i18n="btnSelectFile">é¸æ“‡æª”æ¡ˆ</button>
                                <span id="file-name-display" class="text-xs text-gray-400 truncate"
                                    data-i18n="noFileSelected">æœªé¸æ“‡ä»»ä½•æª”æ¡ˆ</span>
                                <input id="upload-tool-file" type="file" accept=".html" class="hidden"
                                    onchange="updateFileNameDisplay(this)">
                            </div>
                            <p class="text-xs text-gray-500 mt-1" data-i18n="toolFileDesc">æª”æ¡ˆå°‡è‡ªå‹•å„²å­˜è‡³ tools è³‡æ–™å¤¾</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1" data-i18n="toolDescHeader">æè¿° * (è‡³å°‘ 10
                            å­—)</label>
                        <textarea id="upload-tool-desc"
                            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white h-20"
                            data-i18n-placeholder="toolDescPlaceholder" placeholder="æè¿°å·¥å…·çš„åŠŸèƒ½èˆ‡ä½¿ç”¨æ–¹å¼..."></textarea>
                    </div>
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-i18n="toolIcon">åœ–ç¤º</label>
                            <input id="upload-tool-icon" type="text"
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white"
                                placeholder="ğŸ”§" maxlength="2">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-i18n="toolCategory">åˆ†é¡ *</label>
                            <select id="upload-tool-category"
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white">
                                <option value="github" data-i18n="catGithub">ğŸ”§ GitHub å·¥å…·</option>
                                <option value="writing" data-i18n="catWriting">âœï¸ å¯«ä½œè¼”åŠ©</option>
                                <option value="practice" data-i18n="catPractice">ğŸ¯ ç·´ç¿’å·¥å…·</option>
                                <option value="analysis" data-i18n="catAnalysis">ğŸ“Š åˆ†æå·¥å…·</option>
                                <option value="utility" data-i18n="catUtility">âš™ï¸ å…¶ä»–å·¥å…·</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1" data-i18n="toolCost">ä»£å¹£åƒ¹æ ¼ (10-500)</label>
                            <input id="upload-tool-cost" type="number" min="10" max="500"
                                class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white"
                                value="50">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1" data-i18n="toolFeatures">ç‰¹è‰²åŠŸèƒ½ (ç”¨é€—è™Ÿåˆ†éš”)</label>
                        <input id="upload-tool-features" type="text" data-i18n-placeholder="placeholderFeatures"
                            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white"
                            placeholder="ä¾‹ï¼šè‡ªå‹•ä¿å­˜, AI è¼”åŠ©, ä¸€éµæ“ä½œ">
                    </div>
                    <div class="pt-4 border-t border-gray-700">
                        <button onclick="uploadNewTool()" class="btn-primary w-full text-lg py-3" data-i18n="uploadBtn">
                            ğŸš€ ä¸Šå‚³åˆ°å·¥å…·å•†åº—
                        </button>
                        <p class="text-xs text-gray-500 mt-2 text-center" data-i18n="uploadNote">
                            ä¸Šå‚³æˆåŠŸå¾Œå¯ç²å¾— 25 XPï¼Œä¸”ä½ å°‡è‡ªå‹•æ“æœ‰è©²å·¥å…·
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Plugin Store (æ•ˆæœå•†åº—) -->
        <div id="tab-plugins" class="tab-content">
            <h2 class="text-xl font-bold mb-4" data-i18n="pluginTitle">ğŸ”Œ æ•ˆæœå•†åº—</h2>
            <p class="text-gray-400 mb-4" data-i18n="pluginDesc">ä½¿ç”¨ä»£å¹£è§£é–ç‰¹æ•ˆæ’ä»¶ï¼Œç²å¾— XPã€ä»£å¹£åŠ æˆç­‰æ•ˆæœï¼</p>
            <div id="plugin-store" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
        </div>

        <!-- Tab Content: Achievements -->
        <div id="tab-achievements" class="tab-content">
            <h2 class="text-xl font-bold mb-4" data-i18n="achieveTitle">ğŸ† æˆå°±åˆ—è¡¨</h2>
            <div id="achievements-grid" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-8 border-t border-gray-800 mt-8">
            <p class="text-gray-500 text-sm">Quest Empire v2.1 â€” å·¥å…·å•†åº—ç³»çµ±å·²ä¸Šç·š âš”ï¸ğŸ§°</p>
            <button onclick="resetProgress()" class="mt-4 text-xs text-gray-600 hover:text-red-500"
                data-i18n="resetBtn">âš ï¸ é‡ç½®æ‰€æœ‰é€²åº¦</button>
        </footer>
    </div>

    <!-- Reflection Modal -->
    <div id="reflection-modal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4" data-i18n="reflectTitle">ğŸ“ æ’°å¯«æˆ°é¬¥æª¢è¨</h3>
            <p class="text-gray-400 mb-2" data-i18n="reflectSubtitle">é€éæ·±åº¦åæ€ç²å¾—é¡å¤–ç¶“é©—å€¼åŠ æˆï¼</p>
            <p id="reflection-battle-info" class="text-indigo-400 mb-4"></p>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1" data-i18n="reflectLabel">åæ€å…§å®¹ (è‡³å°‘ 50 å­—)</label>
                    <textarea id="reflection-content"
                        class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white h-32"
                        data-i18n-placeholder="placeholderReflection"
                        placeholder="é€™æ¬¡æˆ°é¬¥ä¸­å­¸åˆ°ä»€éº¼ï¼Ÿå“ªäº›å¼±é»éœ€è¦åŠ å¼·ï¼Ÿä¸‹æ¬¡å¦‚ä½•æ”¹é€²ï¼Ÿ"></textarea>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeModal('reflection-modal')" class="flex-1 px-4 py-2 bg-gray-700 rounded-lg"
                        data-i18n="btnLater">ç¨å¾Œå†èªª</button>
                    <button onclick="submitReflection()" class="flex-1 btn-primary" data-i18n="btnSubmit">æäº¤åæ€</button>
                </div>
            </div>
        </div>
    </div>

    <script src="DevScribeRPG.js"></script>
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸŒ INTERNATIONALIZATION (i18n)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        window.i18n = {
            currentLang: 'zh',
            translations: {
                zh: {
                    pageTitle: "Quest Empire - æŒ‘æˆ°è€…æˆé•·å¹³å°",
                    mainTitle: "QUEST EMPIRE",
                    subTitle: "ğŸ® æŒ‘æˆ°è€…æˆé•·å¹³å° â€” é€éç«¶æŠ€å ´æŒ‘æˆ°ç²å¾—ä»£å¹£èˆ‡ç¶“é©—å€¼",

                    // Player Status
                    currentRank: "ç•¶å‰ç­‰ç´š",
                    totalXP: "ç¸½ç¶“é©—å€¼",
                    tokens: "ğŸ’° ä»£å¹£",
                    victories: "å‹åˆ©å ´æ¬¡",
                    defeats: "å¤±æ•—å ´æ¬¡",
                    unlockedTools: "å·²è§£é–å·¥å…·",
                    streakDays: "é€£çºŒå¤©æ•¸",
                    xpNeeded: "é‚„éœ€ {xp} XP å‡ç´š",

                    // Arena Card
                    arenaTitle: "æŒ‘æˆ°è€…ç«¶æŠ€å ´",
                    arenaDesc: "æäº¤ä½œæ–‡æŒ‘æˆ°ä½ çš„å¼±é» Bossï¼AI æœƒè‡ªå‹•è©•ä¼°ä¸¦åˆ¤å®šå‹æ•—ã€‚",
                    arenaBtn: "é€²å…¥ç«¶æŠ€å ´ â†’",
                    arenaRewardWin: "âœ… å‹åˆ© = XP + ä»£å¹£",
                    arenaRewardReview: "ğŸ“ æª¢è¨ = é¡å¤– XP åŠ æˆ",
                    arenaRewardUnlock: "ğŸ”“ è§£é– = ä½¿ç”¨ä»£å¹£æ› Plugin",

                    // Tabs
                    tabBattles: "ğŸ“œ æˆ°é¬¥ç´€éŒ„",
                    tabTools: "ğŸ§° å·¥å…·å•†åº—",
                    tabEquip: "ğŸ’ æˆ‘çš„è£å‚™",
                    tabUpload: "ğŸ“¤ ä¸Šå‚³å·¥å…·",
                    tabPlugins: "ğŸ”Œ æ•ˆæœå•†åº—",
                    tabAchieve: "ğŸ† æˆå°±",

                    // Battle Log
                    logTitle: "ğŸ“œ æœ€è¿‘æˆ°é¬¥ç´€éŒ„",
                    logEmpty: "é‚„æ²’æœ‰æˆ°é¬¥ç´€éŒ„",
                    logEmptyDesc: "å‰å¾€ç«¶æŠ€å ´é–‹å§‹ä½ çš„ç¬¬ä¸€å ´æŒ‘æˆ°ï¼",
                    winTitle: "æŒ‘æˆ°æˆåŠŸï¼",
                    loseTitle: "æŒ‘æˆ°å¤±æ•—",
                    reviewBtn: "ğŸ“ æ’°å¯«æª¢è¨ (+XP)",
                    reviewed: "å·²åæ€ âœ“",
                    improvement: "ğŸ“ˆ é€²æ­¥",
                    regression: "ğŸ“‰ éœ€åŠ å¼·",

                    // Tools Store
                    storeTitle: "ğŸ§° å·¥å…·å•†åº—",
                    storeDesc: "ä½¿ç”¨ä»£å¹£å…Œæ›å¼·å¤§çš„ HTML å·¥å…·ï¼Œæå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼",
                    catAll: "å…¨éƒ¨",
                    catGithub: "ğŸ”§ GitHub",
                    catWriting: "âœï¸ å¯«ä½œ",
                    catPractice: "ğŸ¯ ç·´ç¿’",
                    catAnalysis: "ğŸ“Š åˆ†æ",
                    catUtility: "âš™ï¸ å…¶ä»–",
                    toolEmpty: "æ­¤åˆ†é¡ç›®å‰æ²’æœ‰å·¥å…·",
                    clickToUse: "é»æ“Šä½¿ç”¨ â†’",
                    usages: "æ¬¡ä½¿ç”¨",

                    // Equipment
                    equipTitle: "ğŸ’ æˆ‘çš„è£å‚™",
                    equipDesc: "é€™è£¡æ˜¯ä½ å·²å…Œæ›çš„å·¥å…·ï¼Œé»æ“Šå³å¯ä½¿ç”¨ï¼",
                    equipOwned: "å·²æ“æœ‰",
                    equipUnit: "å€‹å·¥å…·",
                    equipEmpty: "ä½ é‚„æ²’æœ‰ä»»ä½•è£å‚™",
                    equipEmptyDesc: "å‰å¾€å·¥å…·å•†åº—å…Œæ›ä½ çš„ç¬¬ä¸€å€‹å·¥å…·å§ï¼",

                    // Upload
                    uploadHeader: "ğŸ’¡ ç©ºé–“åŒæ­¥æ¨¡å¼",
                    uploadHeaderDesc: "ç¾åœ¨æ”¯æ´ç›´æ¥å°‡å·¥å…·ä¸Šå‚³è‡³ç³»çµ±ç©ºé–“ï¼",
                    uploadStep1: "é¸æ“‡ä½ çš„ HTML å·¥å…·æª”æ¡ˆï¼ˆç³»çµ±æœƒè‡ªå‹•å°‡å…¶åŒæ­¥åˆ° tools/ ç©ºé–“ï¼‰ã€‚",
                    uploadStep2: "å¡«å¯«å·¥å…·è³‡è¨Šå¾Œé»æ“Šä¸Šå‚³ã€‚",
                    uploadStep3: "ä¸Šå‚³å¾Œï¼Œä½ å’Œå…¶ä»–ç©å®¶å³å¯ç›´æ¥å¾ç©ºé–“ä¸‹è¼‰ä¸¦ä½¿ç”¨è©²å·¥å…·ã€‚",
                    toolName: "å·¥å…·åç¨± *",
                    toolFile: "é¸æ“‡ HTML æª”æ¡ˆ *",
                    toolFileDesc: "æª”æ¡ˆå°‡è‡ªå‹•å„²å­˜è‡³ tools è³‡æ–™å¤¾",
                    toolDescHeader: "æè¿° * (è‡³å°‘ 10 å­—)",
                    toolDescPlaceholder: "æè¿°å·¥å…·çš„åŠŸèƒ½èˆ‡ä½¿ç”¨æ–¹å¼...",
                    toolIcon: "åœ–ç¤º",
                    toolCategory: "åˆ†é¡ *",
                    toolCost: "ä»£å¹£åƒ¹æ ¼ (10-500)",
                    toolFeatures: "ç‰¹è‰²åŠŸèƒ½ (ç”¨é€—è™Ÿåˆ†éš”)",
                    uploadBtn: "ğŸš€ ä¸Šå‚³åˆ°å·¥å…·å•†åº—",
                    uploadNote: "ä¸Šå‚³æˆåŠŸå¾Œå¯ç²å¾— 25 XPï¼Œä¸”ä½ å°‡è‡ªå‹•æ“æœ‰è©²å·¥å…·",

                    // Equipment
                    launchTool: "ğŸš€ å•Ÿå‹•å·¥å…·",
                    fileName: "ğŸ“‚ æª”æ¡ˆ",

                    // Plugins
                    pluginTitle: "ğŸ”Œ æ•ˆæœå•†åº—",
                    pluginDesc: "ä½¿ç”¨ä»£å¹£è§£é–ç‰¹æ•ˆæ’ä»¶ï¼Œç²å¾— XPã€ä»£å¹£åŠ æˆç­‰æ•ˆæœï¼",
                    pluginOwned: "âœ“ å·²æ“æœ‰",

                    // Achievements
                    achieveTitle: "ğŸ† æˆå°±åˆ—è¡¨",
                    achieveUnlocked: "âœ“ å·²è§£é–",

                    // Footer
                    resetBtn: "âš ï¸ é‡ç½®æ‰€æœ‰é€²åº¦",

                    // Ranks (Common with Arena)
                    rpgRank1: 'æ–°æ‰‹æŒ‘æˆ°è€…',
                    rpgRank2: 'å­¸å¾’å†’éšªè€…',
                    rpgRank3: 'æ¢ç´¢è€…',
                    rpgRank4: 'æŒ‘æˆ°å¤§å¸«',
                    rpgRank5: 'èè‹±æˆ°å£«',
                    rpgRank6: 'å°ˆå®¶åš®å°',
                    rpgRank7: 'å‰µé€ å¤§å¸«',
                    rpgRank8: 'ç…‰é‡‘è¡“å¤§å¸«',
                    rpgRank9: 'å‚³å¥‡å¥ åŸºè€…',
                    rpgRank10: 'å¸åœ‹é ˜è¢–',

                    // Tiers
                    tierPrototype: "åŸå‹",
                    tierBronze: "é’éŠ…",
                    tierSilver: "ç™½éŠ€",
                    tierGold: "é»ƒé‡‘",
                    tierLegendary: "å‚³å¥‡",

                    // Default Plugins
                    plugin_xp_boost_name: "ç¶“é©—å€¼åŠ é€Ÿå™¨",
                    plugin_xp_boost_desc: "å®ŒæˆæŒ‘æˆ°æ™‚ç²å¾—é¡å¤– 20% XP åŠ æˆ",
                    plugin_token_boost_name: "ä»£å¹£æ”¶é›†å™¨",
                    plugin_token_boost_desc: "å®ŒæˆæŒ‘æˆ°æ™‚ç²å¾—é¡å¤– 30% ä»£å¹£",
                    plugin_streak_shield_name: "é€£çºŒå¤©æ•¸è­·ç›¾",
                    plugin_streak_shield_desc: "ä¿è­·ä¸€æ¬¡ä¸­æ–·çš„é€£çºŒå¤©æ•¸ç´€éŒ„",
                    plugin_reflection_bonus_name: "æ·±åº¦åæ€å¢å¹…",
                    plugin_reflection_bonus_desc: "æ’°å¯«æª¢è¨æ–‡ç« æ™‚ç²å¾—é¡å¤– 50% XP",
                    plugin_challenge_radar_name: "æŒ‘æˆ°é›·é”",
                    plugin_challenge_radar_desc: "æ¨è–¦é©åˆä½ çš„æŒ‘æˆ°é¡å‹",

                    // Default Tools
                    tool_github_push_name: "GitHub Push åŠ©æ‰‹",
                    tool_github_push_desc: "ä¸€éµæ¨é€ä»£ç¢¼åˆ° GitHubï¼Œæ”¯æ´ Exe æ–‡ä»¶ã€AI è·¯å¾‘è§£æã€åŒæ­¥åŠŸèƒ½",
                    tool_create_pr_name: "PR å‰µå»ºå™¨",
                    tool_create_pr_desc: "å¿«é€Ÿå‰µå»º GitHub Pull Requestï¼Œè‡ªå‹•ç”Ÿæˆæè¿°å’Œæ¨™ç±¤",
                    tool_draft_editor_name: "è‰ç¨¿ç·¨è¼¯å™¨",
                    tool_draft_editor_desc: "å¼·å¤§çš„å¯«ä½œè‰ç¨¿ç·¨è¼¯å·¥å…·ï¼Œæ”¯æ´å¤šç¨®æ ¼å¼å’Œè‡ªå‹•ä¿å­˜",
                    tool_github_issue_name: "Issue ç¥¨æ“šå‰µå»ºå™¨",
                    tool_github_issue_desc: "å¿«é€Ÿå‰µå»º GitHub Issueï¼Œæ”¯æ´æ¨¡æ¿å’Œè‡ªå‹•åˆ†é¡",
                    tool_immerse_practice_name: "æ²‰æµ¸å¼ç·´ç¿’å™¨",
                    tool_immerse_practice_desc: "è‹±èªæ²‰æµ¸å¼ç·´ç¿’å·¥å…·ï¼Œæ”¯æ´ WT1 é¡å‹çš„å¯«ä½œè¨“ç·´",
                    tool_proof_writing_name: "å¯«ä½œè­‰æ˜å„€è¡¨æ¿",
                    tool_proof_writing_desc: "è¿½è¹¤å’Œå±•ç¤ºä½ çš„å¯«ä½œé€²åº¦ï¼Œç”Ÿæˆå°ˆæ¥­çš„æˆæœå ±å‘Š",
                    tool_learning_coach_name: "å€‹äººå­¸ç¿’æ•™ç·´",
                    tool_learning_coach_desc: "AI é©…å‹•çš„å€‹äººåŒ–å­¸ç¿’äº’å‹•å·¥å…·",
                    tool_deliberate_practice_name: "åˆ»æ„ç·´ç¿’å°ç­–å¹«æ‰‹",
                    tool_deliberate_practice_desc: "æ ¹æ“šä½ çš„å¼±é»æä¾›é‡å°æ€§çš„ç·´ç¿’ç­–ç•¥",
                    tool_spec_kit_agent_name: "Spec Kit AI Agent",
                    tool_spec_kit_agent_desc: "åŸºæ–¼ Spec-Driven Development æ–¹æ³•è«–çš„ AI ä»£ç¢¼ç”Ÿæˆå™¨ï¼Œè¼•é¬†å‰µå»ºå‰ç«¯æ‡‰ç”¨",

                    // Tool Features
                    featExe: "Exe æ”¯æ´",
                    featAI: "AI è·¯å¾‘",
                    featSync: "åŒæ­¥åŠŸèƒ½",
                    featStrict: "çµ„ä»¶åš´æ ¼æ¨¡å¼",
                    featMaps: "GitHitMaps",
                    featAutoDesc: "è‡ªå‹•æè¿°",
                    featTag: "æ¨™ç±¤ç”Ÿæˆ",
                    featTemplate: "æ¨¡æ¿æ”¯æ´",
                    featAutoSave: "è‡ªå‹•ä¿å­˜",
                    featMultiFormat: "å¤šæ ¼å¼æ”¯æ´",
                    featVersion: "ç‰ˆæœ¬æ§åˆ¶",
                    featTemplates: "æ¨¡æ¿ç³»çµ±",
                    featAutoCat: "è‡ªå‹•åˆ†é¡",
                    featPriority: "å„ªå…ˆç´šè¨­å®š",
                    featImmersive: "æ²‰æµ¸å¼å­¸ç¿’",
                    featWT1: "WT1 å°ˆç”¨",
                    featTrack: "é€²åº¦è¿½è¹¤",
                    featReport: "å ±å‘Šç”Ÿæˆ",
                    featVisual: "æ•¸æ“šè¦–è¦ºåŒ–",
                    featAIInteract: "AI äº’å‹•",
                    featAdvice: "å€‹äººåŒ–å»ºè­°",
                    featWeakness: "å¼±é»åˆ†æ",
                    featStrategy: "ç­–ç•¥å»ºè­°",
                    featPlan: "ç·´ç¿’è¨ˆåŠƒ",

                    // Achievements
                    ach_first_challenge_name: "åˆæ¬¡æŒ‘æˆ°",
                    ach_first_challenge_desc: "å®Œæˆç¬¬ä¸€å€‹æŒ‘æˆ°",
                    ach_first_reflection_name: "åæ€è€…",
                    ach_first_reflection_desc: "æ’°å¯«ç¬¬ä¸€ç¯‡æª¢è¨æ–‡ç« ",
                    ach_challenge_10_name: "æŒ‘æˆ°é”äºº",
                    ach_challenge_10_desc: "å®Œæˆ 10 å€‹æŒ‘æˆ°",
                    ach_challenge_50_name: "æŒ‘æˆ°å¤§å¸«",
                    ach_challenge_50_desc: "å®Œæˆ 50 å€‹æŒ‘æˆ°",
                    ach_token_500_name: "è²¡å¯Œç´¯ç©è€…",
                    ach_token_500_desc: "ç´¯ç© 500 ä»£å¹£",
                    ach_token_2000_name: "ä»£å¹£å¤§äº¨",
                    ach_token_2000_desc: "ç´¯ç© 2000 ä»£å¹£",
                    ach_unlock_plugin_name: "å·¥å…·è§£é–è€…",
                    ach_unlock_plugin_desc: "è§£é–ç¬¬ä¸€å€‹ Plugin",
                    ach_unlock_5_plugins_name: "å·¥å…·æ”¶è—å®¶",
                    ach_unlock_5_plugins_desc: "è§£é– 5 å€‹ Plugin",
                    ach_create_plugin_name: "å‰µé€ è€…",
                    ach_create_plugin_desc: "å‰µå»ºç¬¬ä¸€å€‹è‡ªè£½ Plugin",
                    ach_plugin_sold_name: "é–‹ç™¼å•†",
                    ach_plugin_sold_desc: "è‡ªè£½ Plugin è¢«ä»–äººå…Œæ›",
                    ach_streak_7_name: "é€±æœ«æˆ°å£«",
                    ach_streak_7_desc: "é€£çºŒ 7 å¤©æ´»å‹•",
                    ach_level_10_name: "å¸åœ‹é ˜è¢–",
                    ach_level_10_desc: "é”åˆ°æœ€é«˜ç­‰ç´š",

                    // Alerts & Notifications
                    alertMin50: "åæ€å…§å®¹è‡³å°‘éœ€è¦ 50 å­—ï¼",
                    notifyReflectSuccess: "åæ€å·²æäº¤ï¼",
                    notifyReflectReward: "+{xp} XP, +{tokens} ğŸ’°",
                    confirmUnlockPlugin: "ç¢ºå®šè¦ç”¨ {cost} ä»£å¹£è§£é–ã€Œ{name}ã€æ•ˆæœï¼Ÿ",
                    notifyPluginUnlocked: "æ•ˆæœå·²è§£é–ï¼",
                    alertToolNotFound: "æ‰¾ä¸åˆ°æ­¤å·¥å…·",
                    confirmUnlockTool: "ç¢ºå®šè¦ç”¨ {cost} ä»£å¹£å…Œæ›ã€Œ{name}ã€ï¼Ÿ\n\n{desc}",
                    notifyToolUnlocked: "å·¥å…·å·²å…Œæ›ï¼",
                    notifyToolOwned: "{name} å·²åŠ å…¥ä½ çš„è£å‚™",
                    notifyLaunching: "å•Ÿå‹•å·¥å…·",
                    alertEnterName: "è«‹è¼¸å…¥å·¥å…·åç¨±",
                    alertSelectFile: "è«‹é¸æ“‡ HTML æª”æ¡ˆ",
                    alertMin10: "æè¿°è‡³å°‘éœ€è¦ 10 å€‹å­—",
                    notifyUploading: "ä¸Šå‚³ä¸­...",
                    notifySyncing: "æ­£åœ¨åŒæ­¥åˆ°ç³»çµ±ç©ºé–“...",
                    notifyUploadSuccess: "å·¥å…·ä¸Šå‚³èˆ‡åŒæ­¥æˆåŠŸï¼",
                    notifyUploadReward: "{name} å·²ä¸Šæ¶ï¼Œç²å¾— +{xp} XP",
                    alertRegisteFail: "éŠæˆ²ç³»çµ±è¨»å†Šå¤±æ•—: ",
                    alertUploadFail: "ä¸Šå‚³å¤±æ•—: ç„¡æ³•é€£æ¥åˆ°ç©ºé–“ä¼ºæœå™¨ (arena_api.py)ã€‚è«‹ç¢ºèª Python å¾Œç«¯æ­£åœ¨é‹è¡Œã€‚\néŒ¯èª¤: ",
                    notifyPluginUploaded: "æ•ˆæœå·²ä¸Šå‚³ï¼",
                    confirmReset: "âš ï¸ ç¢ºå®šè¦é‡ç½®æ‰€æœ‰é€²åº¦å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼",
                    battleResult: "æˆ°é¬¥çµæœ",
                    victory: "å‹åˆ©",
                    defeat: "å¤±æ•—",

                    // Form Placeholders & Labels
                    placeholderToolName: "ä¾‹ï¼šGitHub è‡ªå‹•æ¨é€åŠ©æ‰‹",
                    placeholderFeatures: "ä¾‹ï¼šè‡ªå‹•ä¿å­˜, AI è¼”åŠ©, ä¸€éµæ“ä½œ",
                    toolDescPlaceholder: "æè¿°å·¥å…·çš„åŠŸèƒ½èˆ‡ä½¿ç”¨æ–¹å¼...",
                    btnSelectFile: "é¸æ“‡æª”æ¡ˆ",
                    noFileSelected: "æœªé¸æ“‡ä»»ä½•æª”æ¡ˆ",

                    // Metrics (From Arena)
                    ta_overview_clarity: 'TA: æ¦‚è¿°æ¸…æ™°åº¦',
                    ta_key_step_coverage: 'TA: é—œéµæ­¥é©Ÿæ¶µè“‹åº¦',
                    ta_step_coverage: 'TA: æ­¥é©Ÿæ¶µè“‹åº¦',
                    ta_factual_accuracy: 'TA: äº‹å¯¦æº–ç¢ºæ€§',
                    ta_logic_accuracy: 'TA: é‚è¼¯æº–ç¢ºæ€§',
                    ta_data_accuracy: 'TA: é‚è¼¯æº–ç¢ºæ€§',
                    cc_sequencing_markers: 'CC: é †åºæ¨™è¨˜',
                    cc_sequencing_markers_desc: 'è©•ä¼°æ˜¯å¦æœ‰æ•ˆä½¿ç”¨æ™‚é–“é †åºè©ï¼ˆå¦‚ï¼šFirst, Next, Then, Finallyï¼‰ã€‚',
                    cc_referencing: 'CC: æŒ‡ä»£é€£æ¥',
                    cc_paragraphing: 'CC: æ®µè½é‚è¼¯',
                    cc_logical_paragraphing: 'CC: æ®µè½é‚è¼¯',
                    lr_process_verbs: 'LR: æµç¨‹å‹•è©',
                    lr_topic_vocabulary: 'LR: ä¸»é¡Œè©å½™é‡',
                    lr_topic_nouns: 'LR: ä¸»é¡Œè©å½™',
                    lr_paraphrasing: 'LR: æ”¹å¯«èƒ½åŠ›',
                    lr_paraphrasing_power: 'LR: æ”¹å¯«èƒ½åŠ›',

                    // Reflection Modal
                    reflectTitle: "ğŸ“ æ’°å¯«æˆ°é¬¥æª¢è¨",
                    reflectSubtitle: "é€éæ·±åº¦åæ€ç²å¾—é¡å¤–ç¶“é©—å€¼åŠ æˆï¼",
                    reflectLabel: "åæ€å…§å®¹ (è‡³å°‘ 50 å­—)",
                    placeholderReflection: "é€™æ¬¡æˆ°é¬¥ä¸­å­¸åˆ°ä»€éº¼ï¼Ÿå“ªäº›å¼±é»éœ€è¦åŠ å¼·ï¼Ÿä¸‹æ¬¡å¦‚ä½•æ”¹é€²ï¼Ÿ",
                    btnLater: "ç¨å¾Œå†èªª",
                    btnSubmit: "æäº¤åæ€",
                    band: "Bandçš„åˆ†æ•¸",
                    lr_conciseness: 'LR: ç²¾ç°¡åº¦',
                    lr_precision_conciseness: 'LR: ç²¾æº–èˆ‡ç²¾ç°¡',
                    lr_precision_and_conciseness: 'LR: ç²¾æº–èˆ‡ç²¾ç°¡',
                    gra_passive_voice: 'GRA: è¢«å‹•èªæ…‹',
                    gra_passive_voice_control: 'GRA: è¢«å‹•èªæ…‹æ§åˆ¶',
                    gra_complex_structures: 'GRA: å¥å‹å¤šæ¨£æ€§',
                    gra_sentence_variety: 'GRA: å¥å‹è®Šæ›',
                    gra_error_free_density: 'GRA: ç„¡éŒ¯èª¤ç‡',
                    gra_error_free_sentences: 'ç„¡éŒ¯èª¤ç‡',
                    firstSubmission: "é¦–æ¬¡æäº¤ï¼",
                    first_submission: "é¦–æ¬¡æäº¤ï¼",
                    firstsubmission: "é¦–æ¬¡æäº¤ï¼",

                    // Error Messages (from RPG Engine)
                    errToolNotFound: "æ‰¾ä¸åˆ°æ­¤å·¥å…·",
                    errPluginNotFound: "æ‰¾ä¸åˆ°æ•ˆæœæ’ä»¶",
                    errAlreadyOwned: "ä½ å·²ç¶“æ“æœ‰æ­¤é …ç›®",
                    errInsufficientTokens: "ä»£å¹£ä¸è¶³ï¼éœ€è¦ {cost} ä»£å¹£ï¼Œä½ åªæœ‰ {balance} ä»£å¹£",
                    errNotUnlockedPlugin: "ä½ é‚„æ²’æœ‰è§£é–æ­¤æ•ˆæœ",
                    errAlreadyActivePlugin: "æ­¤æ•ˆæœå·²ç¶“å•Ÿç”¨",
                    errMaxActivePlugins: "æœ€å¤šåŒæ™‚å•Ÿç”¨ 3 å€‹æ•ˆæœ",
                    errNotActivePlugin: "æ­¤æ•ˆæœæœªå•Ÿç”¨",
                    errMinLengthName: "åç¨±è‡³å°‘éœ€è¦ 2 å€‹å­—å…ƒ",
                    errMinLengthDesc: "æè¿°è‡³å°‘éœ€è¦ 10 å€‹å­—å…ƒ",
                    errTokenRange: "ä»£å¹£åƒ¹æ ¼éœ€åœ¨ 10-500 ä¹‹é–“",
                    errInvalidFileName: "è«‹æä¾›æœ‰æ•ˆçš„ HTML æª”æ¡ˆåç¨±",
                    errInvalidCategory: "è«‹é¸æ“‡æœ‰æ•ˆçš„åˆ†é¡",
                    errNotCompleted: "åªèƒ½å°å·²å®Œæˆçš„æŒ‘æˆ°æ’°å¯«æª¢è¨",
                    errAlreadyReflected: "æ­¤æŒ‘æˆ°å·²æœ‰æª¢è¨æ–‡ç« ",
                    errMinLengthReflection: "æª¢è¨æ–‡ç« è‡³å°‘éœ€è¦ 50 å€‹å­—å…ƒ",

                    // Notifications
                    notifyEarnedXP: "ç²å¾— {xp} XP",
                    notifyLevelUpTitle: "ç­‰ç´šæå‡ï¼",
                    notifyLevelUpMsg: "æ­å–œå‡ç´šè‡³ Lv.{level} {title}",
                    notifyAchievementUnlocked: "æˆå°±è§£é–",
                    notifyToolSaleTitle: "å·¥å…·è²©å”®æˆåŠŸï¼",
                    notifyToolSaleMsg: "+{reward} ğŸ’° å‰µä½œè€…å›é¥‹",
                    rpgGainXP: "ç²å¾—ç¶“é©—å€¼",
                    rpgContrib: "å…¬æœƒè²¢ç»ï¼šæ¨é€æª”æ¡ˆ",
                    rpgArenaWin: "ç«¶æŠ€å ´å‹åˆ©",
                    rpgUnlockTool: "å…Œæ›å·¥å…·ï¼š{name}",
                    rpgUnlockPlugin: "è§£é–æ•ˆæœï¼š{name}",
                    rpgUseTool: "ä½¿ç”¨å·¥å…·ï¼š{name}",
                },
                en: {
                    pageTitle: "Quest Empire - Challenger Hub",
                    mainTitle: "QUEST EMPIRE",
                    subTitle: "ğŸ® Challenger Hub â€” Earn Tokens & XP through Arena Challenges",

                    // Player Status
                    currentRank: "Rank",
                    totalXP: "Total XP",
                    tokens: "ğŸ’° Tokens",
                    victories: "Victories",
                    defeats: "Defeats",
                    unlockedTools: "Tools Unlocked",
                    streakDays: "Streak Days",
                    xpNeeded: "{xp} XP to Level Up",

                    // Arena Card
                    arenaTitle: "Challenger Arena",
                    arenaDesc: "Submit essays to challenge your weakness Boss! AI evaluates your battle.",
                    arenaBtn: "Enter Arena â†’",
                    arenaRewardWin: "âœ… Win = XP + Tokens",
                    arenaRewardReview: "ğŸ“ Review = XP Bonus",
                    arenaRewardUnlock: "ğŸ”“ Unlock = Get Plugins",

                    // Tabs
                    tabBattles: "ğŸ“œ Battle Log",
                    tabTools: "ğŸ§° Tool Store",
                    tabEquip: "ğŸ’ Equipment",
                    tabUpload: "ğŸ“¤ Upload",
                    tabPlugins: "ğŸ”Œ Plugin Store",
                    tabAchieve: "ğŸ† Achievements",

                    // Battle Log
                    logTitle: "ğŸ“œ Recent Battles",
                    logEmpty: "No battle records yet",
                    logEmptyDesc: "Go to the Arena to start your first challenge!",
                    winTitle: "Victory!",
                    loseTitle: "Defeated",
                    reviewBtn: "ğŸ“ Write Review (+XP)",
                    reviewed: "Reviewed âœ“",
                    improvement: "ğŸ“ˆ Improved",
                    regression: "ğŸ“‰ Needs Work",

                    // Tools Store
                    storeTitle: "ğŸ§° Tool Store",
                    storeDesc: "Exchange tokens for powerful HTML tools to boost productivity!",
                    catAll: "All",
                    catGithub: "ğŸ”§ GitHub",
                    catWriting: "âœï¸ Writing",
                    catPractice: "ğŸ¯ Practice",
                    catAnalysis: "ğŸ“Š Analysis",
                    catUtility: "âš™ï¸ Utility",
                    toolEmpty: "No tools in this category",
                    clickToUse: "Click to Use â†’",
                    usages: "uses",

                    // Equipment
                    equipTitle: "ğŸ’ My Equipment",
                    equipDesc: "Tools you have redeemed. Click to launch!",
                    equipOwned: "Owned",
                    equipUnit: "Tools",
                    equipEmpty: "You don't have any equipment yet",
                    equipEmptyDesc: "Visit the Tool Store to get your first tool!",

                    // Upload
                    uploadHeader: "ğŸ’¡ Cloud Sync Mode",
                    uploadHeaderDesc: "Direct upload to system cloud storage is now supported!",
                    uploadStep1: "Select your HTML tool file (Auto-syncs to tools/ folder).",
                    uploadStep2: "Fill in tool details and upload.",
                    uploadStep3: "Once uploaded, you and others can use it instantly.",
                    toolName: "Tool Name *",
                    toolFile: "Select HTML File *",
                    toolFileDesc: "Saved automatically to tools folder",
                    toolDescHeader: "Description * (Min 10 chars)",
                    toolDescPlaceholder: "Describe how to use this tool...",
                    toolIcon: "Icon",
                    toolCategory: "Category *",
                    toolCost: "Token Cost (10-500)",
                    toolFeatures: "Features (comma separated)",
                    uploadBtn: "ğŸš€ Upload to Store",
                    uploadNote: "Get 25 XP upon success. You automatically own the tool.",

                    // Equipment
                    launchTool: "ğŸš€ Launch Tool",
                    fileName: "ğŸ“‚ File",

                    // Plugins
                    pluginTitle: "ğŸ”Œ Plugin Store",
                    pluginDesc: "Unlock effects to get XP/Token bonuses!",
                    pluginOwned: "âœ“ Owned",

                    // Achievements
                    achieveTitle: "ğŸ† Achievements",
                    achieveUnlocked: "âœ“ Unlocked",

                    // Footer
                    resetBtn: "âš ï¸ Reset All Progress",

                    // Ranks
                    rpgRank1: 'Novice Challenger',
                    rpgRank2: 'Apprentice Adventurer',
                    rpgRank3: 'Explorer',
                    rpgRank4: 'Challenge Master',
                    rpgRank5: 'Elite Warrior',
                    rpgRank6: 'Expert Guide',
                    rpgRank7: 'Master Creator',
                    rpgRank8: 'Grandmaster Alchemist',
                    rpgRank9: 'Legendary Founder',
                    rpgRank10: 'Empire Leader',

                    // Tiers
                    tierPrototype: "Prototype",
                    tierBronze: "Bronze",
                    tierSilver: "Silver",
                    tierGold: "Gold",
                    tierLegendary: "Legendary",

                    // Default Plugins
                    plugin_xp_boost_name: "XP Booster",
                    plugin_xp_boost_desc: "Earn +20% bonus XP upon challenge completion",
                    plugin_token_boost_name: "Token Collector",
                    plugin_token_boost_desc: "Earn +30% bonus tokens upon challenge completion",
                    plugin_streak_shield_name: "Streak Shield",
                    plugin_streak_shield_desc: "Protects your daily streak once if you miss a day",
                    plugin_reflection_bonus_name: "Deep Reflection Boost",
                    plugin_reflection_bonus_desc: "Earn +50% XP when writing reflection reviews",
                    plugin_challenge_radar_name: "Challenge Radar",
                    plugin_challenge_radar_desc: "Recommends the best challenge type for you",

                    // Default Tools
                    tool_github_push_name: "GitHub Push Helper",
                    tool_github_push_desc: "Push code to GitHub with Exe support, AI pathing, and sync",
                    tool_create_pr_name: "PR Creator",
                    tool_create_pr_desc: "Quickly create GitHub Pull Requests with auto-desc/tags",
                    tool_draft_editor_name: "Draft Editor",
                    tool_draft_editor_desc: "Powerful writing tool with multi-format and auto-save",
                    tool_github_issue_name: "Issue Ticket Creator",
                    tool_github_issue_desc: "Fast GitHub Issue creation with templates and categories",
                    tool_immerse_practice_name: "Immersive Practice",
                    tool_immerse_practice_desc: "English immersive tool specialized for WT1 writing",
                    tool_proof_writing_name: "Proof Writing Dashboard",
                    tool_proof_writing_desc: "Track and showcase your writing progress with reports",
                    tool_learning_coach_name: "Private Learning Coach",
                    tool_learning_coach_desc: "AI-driven personalized learning interaction tool",
                    tool_deliberate_practice_name: "Deliberate Practice Sorter",
                    tool_deliberate_practice_desc: "Targeted practice strategies based on your weaknesses",

                    // Tool Features
                    featExe: "Exe Support",
                    featAI: "AI Path",
                    featSync: "Sync Feature",
                    featStrict: "Strict Mode",
                    featMaps: "GitHitMaps",
                    featAutoDesc: "Auto Description",
                    featTag: "Tag Generation",
                    featTemplate: "Template Support",
                    featAutoSave: "Auto Save",
                    featMultiFormat: "Multi-format",
                    featVersion: "Version Control",
                    featTemplates: "Templates",
                    featAutoCat: "Auto Category",
                    featPriority: "Priority Setting",
                    featImmersive: "Immersive",
                    featWT1: "WT1 Special",
                    featTrack: "Progress Track",
                    featReport: "Report Gen",
                    featVisual: "Visual Data",
                    featAIInteract: "AI Interaction",
                    featAdvice: "AI Advice",
                    featWeakness: "Weakness Analysis",
                    featStrategy: "Strategy Suggestion",
                    featPlan: "Practice Plan",

                    // Achievements
                    ach_first_challenge_name: "First Challenge",
                    ach_first_challenge_desc: "Complete your very first challenge",
                    ach_first_reflection_name: "Reflectionist",
                    ach_first_reflection_desc: "Write your first reflection review",
                    ach_challenge_10_name: "Challenge Expert",
                    ach_challenge_10_desc: "Complete 10 challenges",
                    ach_challenge_50_name: "Challenge Master",
                    ach_challenge_50_desc: "Complete 50 challenges",
                    ach_token_500_name: "Wealth Accumulator",
                    ach_token_500_desc: "Accumulate 500 tokens",
                    ach_token_2000_name: "Token Tycoon",
                    ach_token_2000_desc: "Accumulate 2000 tokens",
                    ach_unlock_plugin_name: "Tool Unlocker",
                    ach_unlock_plugin_desc: "Unlock your first Plugin",
                    ach_unlock_5_plugins_name: "Tool Collector",
                    ach_unlock_5_plugins_desc: "Unlock 5 different Plugins",
                    ach_create_plugin_name: "The Creator",
                    ach_create_plugin_desc: "Create your first custom Plugin",
                    ach_plugin_sold_name: "Developer",
                    ach_plugin_sold_desc: "Your custom Plugin was redeemed by others",
                    ach_streak_7_name: "Weekend Warrior",
                    ach_streak_7_desc: "Maintain a 7-day activity streak",
                    ach_level_10_name: "Empire Leader",
                    ach_level_10_desc: "Reach the maximum level",

                    // Alerts & Notifications
                    alertMin50: "Reflection must be at least 50 characters!",
                    notifyReflectSuccess: "Reflection submitted!",
                    notifyReflectReward: "+{xp} XP, +{tokens} ğŸ’°",
                    confirmUnlockPlugin: "Are you sure you want to unlock '{name}' for {cost} tokens?",
                    notifyPluginUnlocked: "Effect unlocked!",
                    alertToolNotFound: "Tool not found",
                    confirmUnlockTool: "Are you sure you want to redeem '{name}' for {cost} tokens?\n\n{desc}",
                    notifyToolUnlocked: "Tool redeemed!",
                    notifyToolOwned: "{name} has been added to your gear",
                    notifyLaunching: "Launching Tool",
                    alertEnterName: "Please enter tool name",
                    alertSelectFile: "Please select an HTML file",
                    alertMin10: "Description must be at least 10 characters",
                    notifyUploading: "Uploading...",
                    notifySyncing: "Syncing to system space...",
                    notifyUploadSuccess: "Upload & Sync Successful!",
                    notifyUploadReward: "{name} is now live! Earned +{xp} XP",
                    alertRegisteFail: "Game registration failed: ",
                    alertUploadFail: "Upload Failed: Cannot connect to space server (arena_api.py). Ensure the Python backend is running.\nError: ",
                    notifyPluginUploaded: "Effect uploaded!",
                    confirmReset: "âš ï¸ Are you sure you want to reset all progress? This cannot be undone!",
                    battleResult: "Battle Result",
                    victory: "Victory",
                    defeat: "Defeat",

                    // Form Placeholders & Labels
                    placeholderToolName: "e.g., GitHub Push Helper",
                    placeholderFeatures: "e.g., Auto-save, AI Helper, One-click",
                    toolDescPlaceholder: "Describe how to use this tool...",
                    btnSelectFile: "Choose File",
                    noFileSelected: "No file selected",

                    // Metrics (From Arena)
                    ta_overview_clarity: 'TA: Overview Clarity',
                    ta_key_step_coverage: 'TA: Key Step Coverage',
                    ta_step_coverage: 'TA: Step Coverage',
                    ta_factual_accuracy: 'TA: Factual Accuracy',
                    ta_logic_accuracy: 'TA: Logic Accuracy',
                    ta_data_accuracy: 'TA: Logic Accuracy',
                    cc_sequencing_markers: 'CC: Sequencing Markers',
                    cc_referencing: 'CC: Referencing',
                    cc_paragraphing: 'CC: Paragraph Logic',
                    cc_logical_paragraphing: 'CC: Logical Paragraphing',
                    lr_process_verbs: 'LR: Process Verbs',
                    lr_topic_vocabulary: 'LR: Topic Vocabulary',
                    lr_topic_nouns: 'LR: Topic Nouns',
                    lr_paraphrasing: 'LR: Paraphrasing',
                    lr_paraphrasing_power: 'LR: Paraphrasing Power',
                    lr_conciseness: 'LR: Conciseness',
                    lr_precision_conciseness: 'LR: Precision & Conciseness',
                    lr_precision_and_conciseness: 'LR: Precision & Conciseness',
                    gra_passive_voice: 'GRA: Passive Voice',
                    gra_passive_voice_control: 'GRA: Passive Voice Control',
                    gra_complex_structures: 'GRA: Complex Structures',
                    gra_sentence_variety: 'GRA: Sentence Variety',
                    gra_error_free_density: 'GRA: Error-Free Density',
                    gra_error_free_sentences: 'Error-Free Sentences',

                    // Reflection Modal
                    reflectTitle: "ğŸ“ Write Battle Reflection",
                    reflectSubtitle: "Earn extra XP bonus through deep reflection!",
                    reflectLabel: "Reflection Content (Min 50 chars)",
                    placeholderReflection: "What did you learn? Which weaknesses need work? How to improve next time?",
                    btnLater: "Maybe Later",
                    btnSubmit: "Submit Reflection",
                    band: "Band Score",
                    firstSubmission: "First Submission!",
                    first_submission: "First Submission!",
                    firstsubmission: "First Submission!",

                    // Error Messages (from RPG Engine)
                    errToolNotFound: "Tool not found",
                    errPluginNotFound: "Plugin not found",
                    errAlreadyOwned: "You already own this item",
                    errInsufficientTokens: "Insufficient tokens! Need {cost}, you have {balance}",
                    errNotUnlockedPlugin: "You haven't unlocked this effect yet",
                    errAlreadyActivePlugin: "This effect is already active",
                    errMaxActivePlugins: "Maximum 3 active effects allowed",
                    errNotActivePlugin: "This effect is not active",
                    errMinLengthName: "Name must be at least 2 characters",
                    errMinLengthDesc: "Description must be at least 10 characters",
                    errTokenRange: "Token cost must be between 10 and 500",
                    errInvalidFileName: "Please provide a valid HTML filename",
                    errInvalidCategory: "Please select a valid category",
                    errNotCompleted: "Can only write reflections for completed challenges",
                    errAlreadyReflected: "This challenge already has a reflection",
                    errMinLengthReflection: "Reflection must be at least 50 characters",

                    // Notifications
                    notifyEarnedXP: "Earned {xp} XP",
                    notifyLevelUpTitle: "Level Up!",
                    notifyLevelUpMsg: "Congratulations! Reached Lv.{level} {title}",
                    notifyAchievementUnlocked: "Achievement Unlocked",
                    notifyToolSaleTitle: "Tool Sold Successfully!",
                    notifyToolSaleMsg: "+{reward} ğŸ’° Creator Reward",
                    rpgGainXP: "Gained Experience",
                    rpgContrib: "Guild Contribution: Push Files",
                    rpgArenaWin: "Arena Victory",
                    rpgUnlockTool: "Redeemed Tool: {name}",
                    rpgUnlockPlugin: "Unlocked Effect: {name}",
                    rpgUseTool: "Used Tool: {name}",
                }
            },

            t: function (key, params = {}) {
                let text = (this.translations[this.currentLang] && this.translations[this.currentLang][key]) || key;
                for (const [k, v] of Object.entries(params)) {
                    text = text.replace(new RegExp(`\\{${k}\\}`, 'g'), v);
                }
                return text;
            },

            setLanguage: function (lang) {
                this.currentLang = lang;
                localStorage.setItem('ielts_arena_lang', lang); // Share sync with Arena
                this.applyTranslations();
                updateUI(); // Re-render UI
            },

            loadSavedLanguage: function () {
                const savedLang = localStorage.getItem('ielts_arena_lang');
                if (savedLang && this.translations[savedLang]) {
                    this.currentLang = savedLang;
                }
            },

            applyTranslations: function () {
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (key) el.innerHTML = this.t(key);
                });

                document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-i18n-placeholder');
                    if (key) el.placeholder = this.t(key);
                });

                const btnText = document.getElementById('langBtnText');
                if (btnText) {
                    btnText.innerText = this.currentLang === 'zh' ? 'EN' : 'ä¸­æ–‡';
                }

                document.documentElement.lang = this.currentLang === 'zh' ? 'zh-TW' : 'en';
            }
        };

        window.toggleLanguage = function () {
            const newLang = window.i18n.currentLang === 'zh' ? 'en' : 'zh';
            window.i18n.setLanguage(newLang);
        };

        // Initialize i18n
        window.i18n.loadSavedLanguage();
        window.addEventListener('DOMContentLoaded', () => {
            window.i18n.applyTranslations();
        });

        const ARENA_STORAGE_KEY = 'ielts_challenger_data';
        let currentBattleIndex = null;
        const t = window.i18n.t.bind(window.i18n);

        // Feature translation map
        const FEATURE_MAP = {
            'Exe æ”¯æ´': 'featExe',
            'AI è·¯å¾‘': 'featAI',
            'åŒæ­¥åŠŸèƒ½': 'featSync',
            'çµ„ä»¶åš´æ ¼æ¨¡å¼': 'featStrict',
            'GitHitMaps': 'featMaps',
            'è‡ªå‹•æè¿°': 'featAutoDesc',
            'æ¨™ç±¤ç”Ÿæˆ': 'featTag',
            'æ¨¡æ¿æ”¯æ´': 'featTemplate',
            'è‡ªå‹•ä¿å­˜': 'featAutoSave',
            'å¤šæ ¼å¼æ”¯æ´': 'featMultiFormat',
            'ç‰ˆæœ¬æ§åˆ¶': 'featVersion',
            'æ¨¡æ¿ç³»çµ±': 'featTemplates',
            'è‡ªå‹•åˆ†é¡': 'featAutoCat',
            'å„ªå…ˆç´šè¨­å®š': 'featPriority',
            'æ²‰æµ¸å¼å­¸ç¿’': 'featImmersive',
            'WT1 å°ˆç”¨': 'featWT1',
            'é€²åº¦è¿½è¹¤': 'featTrack',
            'å ±å‘Šç”Ÿæˆ': 'featReport',
            'æ•¸æ“šè¦–è¦ºåŒ–': 'featVisual',
            'AI äº’å‹•': 'featAIInteract',
            'å€‹äººåŒ–å»ºè­°': 'featAdvice',
            'å¼±é»åˆ†æ': 'featWeakness',
            'ç­–ç•¥å»ºè­°': 'featStrategy',
            'ç·´ç¿’è¨ˆåŠƒ': 'featPlan'
        };

        function translateFeature(f) {
            const key = FEATURE_MAP[f];
            return key ? t(key) : f;
        }

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
            });
        });

        function getArenaData() {
            try {
                const saved = localStorage.getItem(ARENA_STORAGE_KEY);
                if (saved) return JSON.parse(saved);
            } catch (e) { console.error(e); }
            return { essays: [], battleLog: [], victories: 0, defeats: 0, currentBosses: [], bossDefeated: {} };
        }

        function updateUI() {
            const state = DevScribeRPG.getState();
            const arenaData = getArenaData();
            const rank = DevScribeRPG.calculateLevel(state.totalXP);
            const progress = DevScribeRPG.getProgressToNextLevel(state.totalXP);

            // Player status
            document.getElementById('rank-icon').textContent = rank.icon;
            document.getElementById('rank-title').textContent = t('rpgRank' + rank.level);
            document.getElementById('rank-title').style.color = rank.color;
            document.getElementById('player-level').textContent = rank.level;
            document.getElementById('total-xp').textContent = state.totalXP.toLocaleString();
            document.getElementById('total-tokens').textContent = state.tokens.toLocaleString();
            document.getElementById('xp-bar').style.width = progress.progress + '%';

            // XP Needed
            const xpVal = `<span class="text-indigo-400">${progress.xpNeeded.toLocaleString()}</span>`;
            document.getElementById('xp-needed-container').innerHTML = t('xpNeeded', { xp: xpVal });

            document.getElementById('xp-current').textContent = progress.currentInLevel.toLocaleString();
            document.getElementById('xp-total').textContent = progress.totalInLevel.toLocaleString();

            // Arena stats
            document.getElementById('stat-victories').textContent = arenaData.victories || 0;
            document.getElementById('stat-defeats').textContent = arenaData.defeats || 0;
            const ownedTools = state.unlockedTools?.length || 0;
            const ownedPlugins = state.unlockedPlugins?.length || 0;
            document.getElementById('plugins-count').textContent = ownedTools + ownedPlugins;
            document.getElementById('streak-days').textContent = state.currentStreak;

            // Tool equipment count
            document.getElementById('owned-tools-count').textContent = ownedTools;

            renderBattleHistory(arenaData);
            renderToolStore();
            renderEquipment();
            renderPluginStore();
            renderAchievements();
        }

        function renderBattleHistory(arenaData) {
            const container = document.getElementById('battle-history');
            const battles = arenaData.battleLog || [];

            if (battles.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-12">
                        <div class="text-5xl mb-4">âš”ï¸</div>
                        <p>${t('logEmpty')}</p>
                        <p class="text-sm mt-2">${t('logEmptyDesc')}</p>
                    </div>`;
                return;
            }

            container.innerHTML = battles.slice(0, 10).map((battle, index) => {
                const time = new Date(battle.timestamp).toLocaleString(window.i18n.currentLang === 'zh' ? 'zh-TW' : 'en-US');
                const hasReflection = battle.reflection;
                const resultTitle = battle.victory ? t('winTitle') : t('loseTitle');

                return `
                    <div class="battle-record ${battle.victory ? 'victory' : 'defeat'}">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="text-3xl">${battle.victory ? 'ğŸ†' : 'ğŸ’”'}</span>
                                <div>
                                    <div class="font-bold ${battle.victory ? 'text-green-400' : 'text-red-400'}">
                                        ${resultTitle}
                                    </div>
                                    <div class="text-sm text-gray-400">${time}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-yellow-400 font-bold text-xl">Band ${battle.band?.toFixed(1) || '-'}</div>
                                ${!hasReflection ? `
                                    <button onclick="openReflectionModal(${index})" class="text-xs text-indigo-400 hover:underline mt-1">
                                        ${t('reviewBtn')}
                                    </button>
                                ` : `<span class="text-xs text-gray-500">${t('reviewed')}</span>`}
                            </div>
                        </div>
                        ${battle.improvements?.length > 0 ? `
                            <div class="text-xs text-green-400 mt-2">
                                ${t('improvement')}: ${battle.improvements.map(i => {
                    const metric = typeof i === 'object' ? i.metric : i;
                    // Try translating metric name with robust normalization
                    const metricKey = metric.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
                    return t(metricKey) !== metricKey ? t(metricKey) : metric;
                }).join(', ')}
                            </div>
                        ` : ''}
                        ${battle.regressions?.length > 0 ? `
                            <div class="text-xs text-red-400 mt-1">
                                ${t('regression')}: ${battle.regressions.map(r => {
                    const metric = typeof r === 'object' ? r.metric : r;
                    const metricKey = metric.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
                    return t(metricKey) !== metricKey ? t(metricKey) : metric;
                }).join(', ')}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Current category filter
        let currentToolCategory = 'all';

        // Tool Store Rendering
        function renderToolStore(category = currentToolCategory) {
            const tools = DevScribeRPG.getAllTools();
            const state = DevScribeRPG.getState();
            const tiers = DevScribeRPG.PLUGIN_TIERS;
            const categories = DevScribeRPG.TOOL_CATEGORIES;

            // Filter by category
            const filteredTools = category === 'all'
                ? tools
                : tools.filter(t => t.category === category);

            const container = document.getElementById('tool-store');

            if (filteredTools.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <div class="text-5xl mb-4">ğŸ§°</div>
                        <p>${t('toolEmpty')}</p>
                    </div>`;
                return;
            }

            container.innerHTML = filteredTools.map(tool => {
                const owned = state.unlockedTools?.includes(tool.id);
                const tierInfo = tiers[tool.tier] || tiers.prototype;
                const categoryInfo = categories[tool.category] || categories.utility;
                // Translate category name
                const catKey = 'cat' + tool.category.charAt(0).toUpperCase() + tool.category.slice(1);
                const catName = t(catKey);

                const rating = tool.rating ? 'â˜…'.repeat(Math.round(tool.rating)) + 'â˜†'.repeat(5 - Math.round(tool.rating)) : '';

                // i18n for names and descriptions
                const nameKey = tool.id + '_name';
                const descKey = tool.id + '_desc';
                const toolName = t(nameKey) !== nameKey ? t(nameKey) : tool.name;
                const toolDesc = t(descKey) !== descKey ? t(descKey) : tool.description;
                const tierName = t('tier' + tool.tier.charAt(0).toUpperCase() + tool.tier.slice(1));

                return `
                    <div class="tool-card ${owned ? 'owned' : ''}" onclick="${owned ? `useTool('${tool.id}')` : `unlockTool('${tool.id}')`}">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-4xl">${tool.icon}</span>
                            <div class="flex-1">
                                <h4 class="font-bold text-white">${toolName}</h4>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="tier-badge" style="background: ${tierInfo.color}20; color: ${tierInfo.color}">
                                        ${tierInfo.icon} ${tierName}
                                    </span>
                                    <span class="text-xs" style="color: ${categoryInfo.color}">
                                        ${categoryInfo.icon} ${catName}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-400 mb-3">${toolDesc}</p>
                        ${tool.features?.length > 0 ? `
                            <div class="mb-3">
                                ${tool.features.slice(0, 3).map(f => `<span class="feature-tag">${translateFeature(f)}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="flex items-center justify-between">
                            <div class="text-xs text-gray-500">
                                ${tool.usages || 0} ${t('usages')}
                                ${rating ? `<span class="rating-stars ml-2">${rating}</span>` : ''}
                            </div>
                            ${owned
                        ? `<span class="text-green-400 text-sm font-semibold">${t('clickToUse')}</span>`
                        : `<span class="text-amber-400 font-bold text-lg">${tool.tokenCost} ğŸ’°</span>`}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Equipment Page Rendering
        function renderEquipment() {
            const ownedTools = DevScribeRPG.getOwnedTools();
            const tiers = DevScribeRPG.PLUGIN_TIERS;
            const categories = DevScribeRPG.TOOL_CATEGORIES;

            const container = document.getElementById('my-equipment');
            const noEquipment = document.getElementById('no-equipment');

            if (ownedTools.length === 0) {
                container.innerHTML = '';
                noEquipment.classList.remove('hidden');
                return;
            }

            noEquipment.classList.add('hidden');

            container.innerHTML = ownedTools.map(tool => {
                const tierInfo = tiers[tool.tier] || tiers.prototype;
                const categoryInfo = categories[tool.category] || categories.utility;

                const nameKey = tool.id + '_name';
                const descKey = tool.id + '_desc';
                const toolName = t(nameKey) !== nameKey ? t(nameKey) : tool.name;
                const toolDesc = t(descKey) !== descKey ? t(descKey) : tool.description;
                const tierName = t('tier' + tool.tier.charAt(0).toUpperCase() + tool.tier.slice(1));

                return `
                    <div class="equipment-card" onclick="useTool('${tool.id}')">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-5xl">${tool.icon}</span>
                            <div class="flex-1">
                                <h4 class="font-bold text-white text-lg">${toolName}</h4>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="tier-badge" style="background: ${tierInfo.color}20; color: ${tierInfo.color}">
                                        ${tierInfo.icon} ${tierName}
                                    </span>
                                    <span class="text-xs" style="color: ${categoryInfo.color}">
                                        ${categoryInfo.icon} ${t('cat' + tool.category.charAt(0).toUpperCase() + tool.category.slice(1))}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-300 mb-3">${toolDesc}</p>
                        ${tool.features?.length > 0 ? `
                            <div class="mb-3">
                                ${tool.features.map(f => `<span class="feature-tag">${translateFeature(f)}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="flex items-center justify-between mt-4 pt-3 border-t border-green-500/30">
                            <span class="text-xs text-gray-400">${t('fileName')}: ${tool.fileName}</span>
                            <span class="text-green-400 font-semibold">${t('launchTool')}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Plugin Store Rendering (æ•ˆæœå•†åº—)
        function renderPluginStore() {
            const plugins = DevScribeRPG.getAllPlugins();
            const state = DevScribeRPG.getState();
            const tiers = DevScribeRPG.PLUGIN_TIERS;

            document.getElementById('plugin-store').innerHTML = plugins.map(p => {
                const owned = state.unlockedPlugins.includes(p.id);
                const tierInfo = tiers[p.tier];

                const nameKey = p.id + '_name';
                const descKey = p.id + '_desc';
                const pluginName = t(nameKey) !== nameKey ? t(nameKey) : p.name;
                const pluginDesc = t(descKey) !== descKey ? t(descKey) : p.description;
                const tierName = t('tier' + p.tier.charAt(0).toUpperCase() + p.tier.slice(1));

                return `
                    <div class="plugin-card ${owned ? 'owned' : ''}" onclick="${owned ? '' : `unlockPlugin('${p.id}')`}">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">${p.icon}</span>
                            <div class="flex-1">
                                <h4 class="font-bold">${pluginName}</h4>
                                <span class="tier-badge" style="background: ${tierInfo.color}20; color: ${tierInfo.color}">${tierInfo.icon} ${tierName}</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-400 mb-3">${pluginDesc}</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500">${p.usages || 0} ${t('usages')}</span>
                            ${owned
                        ? `<span class="text-green-400 text-sm font-semibold">${t('pluginOwned')}</span>`
                        : `<span class="text-amber-400 font-bold">${p.tokenCost} ğŸ’°</span>`}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAchievements() {
            const state = DevScribeRPG.getState();
            const achievements = DevScribeRPG.ACHIEVEMENTS;

            document.getElementById('achievements-grid').innerHTML = achievements.map(ach => {
                const unlocked = state.achievements.includes(ach.id);
                const nameKey = 'ach_' + ach.id + '_name';
                const descKey = 'ach_' + ach.id + '_desc';
                const achName = t(nameKey) !== nameKey ? t(nameKey) : ach.name;
                const achDesc = t(descKey) !== descKey ? t(descKey) : ach.description;

                return `
                    <div class="glass-card p-4 ${unlocked ? 'border-yellow-500 border' : 'opacity-60'}">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl ${unlocked ? '' : 'grayscale'}">${ach.icon}</span>
                            <div>
                                <div class="font-bold ${unlocked ? 'text-yellow-400' : 'text-gray-400'}">${achName}</div>
                                <div class="text-xs text-gray-400">${achDesc}</div>
                            </div>
                        </div>
                        ${unlocked ? `<div class="text-xs text-green-400 mt-2">${t('achieveUnlocked')}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function openReflectionModal(battleIndex) {
            currentBattleIndex = battleIndex;
            const arenaData = getArenaData();
            const battle = arenaData.battleLog[battleIndex];
            document.getElementById('reflection-battle-info').textContent =
                `${t('battleResult')}: ${battle.victory ? t('victory') : t('defeat')} | ${t('band')} ${battle.band?.toFixed(1) || '-'}`;
            document.getElementById('reflection-modal').classList.add('active');
        }

        function submitReflection() {
            const content = document.getElementById('reflection-content').value.trim();
            if (content.length < 50) {
                alert(t('alertMin50'));
                return;
            }

            const arenaData = getArenaData();
            const battle = arenaData.battleLog[currentBattleIndex];

            // Mark as reflected
            battle.reflection = {
                content,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem(ARENA_STORAGE_KEY, JSON.stringify(arenaData));

            // Award bonus XP and tokens
            const qualityScore = Math.min(100, Math.floor(content.length / 10) + 30);
            const bonusXP = Math.floor(30 * (qualityScore / 100));
            const bonusTokens = Math.floor(10 * (qualityScore / 100));

            // Update state via DevScribeRPG
            const state = DevScribeRPG.getState();
            state.totalXP += bonusXP;
            state.tokens += bonusTokens;
            state.totalReflections = (state.totalReflections || 0) + 1;

            // Save to DevScribeRPG storage
            localStorage.setItem('quest_empire_state', JSON.stringify(state));

            DevScribeRPG.showNotification(t('notifyReflectSuccess'), t('notifyReflectReward', { xp: bonusXP, tokens: bonusTokens }), 'success', 'ğŸ“');

            closeModal('reflection-modal');
            document.getElementById('reflection-content').value = '';

            // Reload state
            location.reload();
        }

        function unlockPlugin(pluginId) {
            const plugin = DevScribeRPG.getPluginById(pluginId);
            const nameKey = plugin.id + '_name';
            const pluginName = t(nameKey) !== nameKey ? t(nameKey) : plugin.name;

            if (confirm(t('confirmUnlockPlugin', { cost: plugin.tokenCost, name: pluginName }))) {
                const result = DevScribeRPG.unlockPlugin(pluginId);
                if (result.success) {
                    DevScribeRPG.showNotification(t('notifyPluginUnlocked'), pluginName, 'success', 'ğŸ”“');
                    updateUI();
                } else {
                    const errorMsg = result.errorKey ? t(result.errorKey, result.params) : result.error;
                    alert('âŒ ' + errorMsg);
                }
            }
        }

        // ========= HTML Tools Functions =========

        // Unlock (purchase) a tool
        function unlockTool(toolId) {
            const tool = DevScribeRPG.getToolById(toolId);
            if (!tool) {
                alert(t('alertToolNotFound'));
                return;
            }

            const nameKey = tool.id + '_name';
            const descKey = tool.id + '_desc';
            const toolName = t(nameKey) !== nameKey ? t(nameKey) : tool.name;
            const toolDesc = t(descKey) !== descKey ? t(descKey) : tool.description;

            if (confirm(t('confirmUnlockTool', { cost: tool.tokenCost, name: toolName, desc: toolDesc }))) {
                const result = DevScribeRPG.unlockTool(toolId);
                if (result.success) {
                    DevScribeRPG.showNotification(t('notifyToolUnlocked'), t('notifyToolOwned', { name: toolName }), 'success', 'ğŸ§°');
                    updateUI();
                } else {
                    const errorMsg = result.errorKey ? t(result.errorKey, result.params) : result.error;
                    alert('âŒ ' + errorMsg);
                }
            }
        }

        // Use an owned tool (open the HTML file)
        function useTool(toolId) {
            const tool = DevScribeRPG.getToolById(toolId);
            const nameKey = toolId + '_name';
            const toolName = t(nameKey) !== nameKey ? t(nameKey) : (tool ? tool.name : toolId);

            const result = DevScribeRPG.useTool(toolId);
            if (result.success) {
                DevScribeRPG.showNotification(t('notifyLaunching'), toolName, 'info', 'ğŸš€');
                // Open the tool in a new window/tab
                window.open(result.fileName, '_blank');
            } else {
                const errorMsg = result.errorKey ? t(result.errorKey, result.params) : result.error;
                alert('âŒ ' + errorMsg);
            }
        }

        function updateFileNameDisplay(input) {
            const display = document.getElementById('file-name-display');
            if (input.files && input.files[0]) {
                display.textContent = input.files[0].name;
                display.removeAttribute('data-i18n');
            } else {
                display.setAttribute('data-i18n', 'noFileSelected');
                display.textContent = t('noFileSelected');
            }
        }

        // Upload a new tool (With true file upload)
        async function uploadNewTool() {
            const name = document.getElementById('upload-tool-name').value.trim();
            const fileInput = document.getElementById('upload-tool-file');
            const description = document.getElementById('upload-tool-desc').value.trim();
            const icon = document.getElementById('upload-tool-icon').value.trim() || 'ğŸ”§';
            const category = document.getElementById('upload-tool-category').value;
            const tokenCost = parseInt(document.getElementById('upload-tool-cost').value) || 50;
            const featuresInput = document.getElementById('upload-tool-features').value.trim();
            const features = featuresInput ? featuresInput.split(',').map(f => f.trim()).filter(f => f) : [];

            // Basic Validation
            if (!name) return alert(t('alertEnterName'));
            if (!fileInput.files || fileInput.files.length === 0) return alert(t('alertSelectFile'));
            if (description.length < 10) return alert(t('alertMin10'));

            const file = fileInput.files[0];

            // 1. First, upload the file to our Python Store
            const formData = new FormData();
            formData.append('file', file);

            try {
                DevScribeRPG.showNotification(t('notifyUploading'), t('notifySyncing'), 'info', 'â³');

                const response = await fetch('http://localhost:5000/api/upload-tool', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Server upload failed');
                }

                const remoteFileName = data.filename; // e.g., "tools/myfile.html"
                console.log('File uploaded:', remoteFileName);

                // 2. Register the tool metadata in LocalStorage (Game System)
                const result = DevScribeRPG.uploadTool({
                    name,
                    fileName: remoteFileName, // Use the path returned by server
                    description,
                    icon,
                    category,
                    tokenCost,
                    features
                });

                if (result.success) {
                    DevScribeRPG.showNotification(
                        t('notifyUploadSuccess'),
                        t('notifyUploadReward', { name: result.tool.name, xp: result.bonusXP }),
                        'success',
                        'ğŸ“¤'
                    );

                    // Clear form
                    document.getElementById('upload-tool-name').value = '';
                    fileInput.value = ''; // Clear file input
                    document.getElementById('upload-tool-desc').value = '';
                    document.getElementById('upload-tool-icon').value = '';
                    document.getElementById('upload-tool-category').value = 'github';
                    document.getElementById('upload-tool-cost').value = '50';
                    document.getElementById('upload-tool-features').value = '';

                    updateUI();

                    // Switch to tools tab
                    document.querySelector('[data-tab="tools"]').click();
                } else {
                    alert(t('alertRegisteFail') + result.error);
                }

            } catch (err) {
                console.error(err);
                alert(t('alertUploadFail') + err.message);
            }
        }

        function createNewPlugin() {
            const result = DevScribeRPG.createPlugin({
                name: document.getElementById('new-plugin-name').value,
                description: document.getElementById('new-plugin-desc').value,
                icon: document.getElementById('new-plugin-icon').value || 'ğŸ”§',
                tokenCost: parseInt(document.getElementById('new-plugin-cost').value) || 50
            });
            if (result.success) {
                DevScribeRPG.showNotification(t('notifyPluginUploaded'), result.plugin.name, 'success', 'ğŸ› ï¸');
                document.getElementById('new-plugin-name').value = '';
                document.getElementById('new-plugin-desc').value = '';
                document.getElementById('new-plugin-icon').value = '';
                document.getElementById('new-plugin-cost').value = '50';
                updateUI();
            } else {
                alert('âŒ ' + result.error);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function resetProgress() {
            if (confirm(t('confirmReset'))) {
                DevScribeRPG.resetState();
                localStorage.removeItem(ARENA_STORAGE_KEY);
                location.reload();
            }
        }

        // ========= Event Listeners =========

        // Category filter for tool store
        document.querySelectorAll('.category-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentToolCategory = btn.dataset.category;
                renderToolStore(currentToolCategory);
            });
        });

        // Listen for storage changes (from Arena)
        window.addEventListener('storage', (e) => {
            if (e.key === ARENA_STORAGE_KEY || e.key === 'quest_empire_state') {
                updateUI();
            }
        });

        document.addEventListener('DOMContentLoaded', updateUI);
    </script>

    <!-- Gemini Key Manager -->
    <script src="modules/gemini-key-manager.js"></script>
    <script>
        // Initialize GeminiKeyManager after page load
        document.addEventListener('DOMContentLoaded', async () => {
            // Sync language with page
            GeminiKeyManager.setLang(currentLang);
            // Render input UI in the designated container
            await GeminiKeyManager.renderInputUI('#gemini-key-container');
        });

        // Update GeminiKeyManager language when page language changes
        const originalToggleLanguage = toggleLanguage;
        toggleLanguage = function () {
            originalToggleLanguage();
            GeminiKeyManager.setLang(currentLang);
            GeminiKeyManager.renderInputUI('#gemini-key-container');
        };
    </script>
</body>

</html>