// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ï¿½ï¸â€â™€ï¸ API KEY æ·±åº¦é©—è­‰è…³æœ¬ (Gemini Native Protocol)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ä½¿ç”¨æ–¹æ³•ï¼šè¤‡è£½æ­¤å…§å®¹ï¼Œåœ¨ç€è¦½å™¨ Console (F12) è²¼ä¸Šä¸¦åŸ·è¡Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(async () => {
    console.clear();
    console.log('ğŸš€ é–‹å§‹é©—è­‰ API Keys...');

    // 1. å–å¾—ç›®å‰é…ç½®
    const cfg = JSON.parse(localStorage.getItem('speckit_config'))?.gemini;
    if (!cfg) return console.error('âŒ æ‰¾ä¸åˆ°é…ç½®ï¼è«‹å…ˆåŸ·è¡Œä¸Šæ–¹çš„é‡ç½®è…³æœ¬ã€‚');

    const keys = [cfg.key, ...(cfg.keys || [])].filter(k => k);
    const model = cfg.model || 'gemini-2.5-flash-preview-09-2025';

    console.log(`ğŸ“‹ æª¢æ¸¬æ¸…å–®: ${keys.length} å€‹ Keys`);
    console.log(`ğŸ¤– æ¸¬è©¦æ¨¡å‹: ${model}`);
    console.log('---------------------------------------------------');

    for (let i = 0; i < keys.length; i++) {
        const key = keys[i];
        const label = i === 0 ? `Key #1 (Phase 2)` : `Key #${i+1} (Reverse)`;
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;
        
        console.log(`ğŸ” æ­£åœ¨æ¸¬è©¦ ${label}...`);

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ role: "user", parts: [{ text: "Hello, valid?" }] }],
                    generationConfig: { maxOutputTokens: 10 }
                })
            });

            if (response.ok) {
                const data = await response.json();
                if (data.candidates && data.candidates.length > 0) {
                    console.log(`âœ… ${label}: é©—è­‰æˆåŠŸï¼`);
                    console.log(`   å›æ‡‰: "${data.candidates[0].content.parts[0].text.trim()}"`);
                } else {
                    console.warn(`âš ï¸ ${label}: è«‹æ±‚æˆåŠŸä½†ç„¡å…§å®¹ (å¯èƒ½æ˜¯æ¨¡å‹å•é¡Œ)`);
                    console.log('Response:', data);
                }
            } else {
                const errText = await response.text();
                let errMsg = `HTTP ${response.status}`;
                try {
                    const errJson = JSON.parse(errText);
                    errMsg += ` - ${errJson.error?.message || errText}`;
                } catch (e) { errMsg += ` - ${errText}`; }
                
                console.error(`âŒ ${label}: é©—è­‰å¤±æ•—ï¼`);
                console.error(`   åŸå› : ${errMsg}`);
            }
        } catch (e) {
            console.error(`âŒ ${label}: é€£ç·šéŒ¯èª¤ï¼`, e);
        }
        console.log('---------------------------------------------------');
    }
})();


let c = JSON.parse(localStorage.getItem('speckit_config'));
c.gemini.model = 'gemini-2.5-flash';
localStorage.setItem('speckit_config', JSON.stringify(c));
location.reload();
