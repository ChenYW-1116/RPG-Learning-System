Stage 1: 建立雙向意圖基準 (Establish Intent Baselines)
請執行以下兩個前置任務以準備分析素材：
1. **規格轉意圖 (Spec to Intent)**：讀取 {001-ielts-wsc_opt_phase1_output_spec.md}，使用下方 `{意圖描述}` 模板將其轉換為結構化的規格意圖文件，輸出為 `{intent1.md}`。
2. **代碼轉意圖 (Code to Intent)**：讀取 {IELTS_Writing-Sprint_Coach.html}，結合 {程式碼逆向工程提示詞.md} 的指引進行逆向分析，並使用相同的 `{意圖描述}` 模板將代碼現狀轉換為實作意圖文件，輸出為 `{intent2.md}`。 

{意圖描述}模板:
1. 業務邏輯型（Rule-Based Intent）
適用於：折扣計算、權限判斷、流程審核等。
公式： 在 [條件/場景] 下，系統應該根據 [規則 A] 執行 [動作 B]，且必須避免 [錯誤情況 C]。
* 範本：
  「我的意圖是建立一個會員折扣邏輯。規則是： 當購物車總額大於 1000 且會員等級為 VIP 時，給予 8 折優惠；但如果商品標籤含有『特價』，則不重複折扣。目前的問題是： 系統會對特價商品重複打折，請修正邏輯以確保特價商品維持原價。」

2. 數據轉換/算法型（Data Processing Intent）
適用於：數據處理、數值運算、數組過濾等。
公式： 當輸入為 [輸入數據] 時，預期的處理步驟是 [步驟 1, 2, 3]，最後輸出的格式應為 [輸出結果]。
* 範本：
  「這段程式碼的意圖是處理用戶名單。預期行為： 先過濾掉重複的 Email，然後按註冊日期由新到舊排序，最後只取前 5 筆。目前的現象： 輸出結果完全沒有排序，且包含重複項。請檢查我的 sort 和 filter 邏輯哪裡衝突了。」

3. 使用者路徑/狀態型（State Machine Intent）
適用於：前端互動、App 頁面跳轉、遊戲狀態。
公式： 當用戶點擊 [按鈕/觸發點] 後，系統應進入 [狀態 A]，只有在 [特定條件] 滿足時才允許跳轉到 [狀態 B]。
* 範本：
  意圖描述：這是一個登入表單。理想流程： 用戶點擊登入後，先顯示 Loading 圖示，若 API 回傳 200 則導向首頁，否則彈出錯誤訊息。現狀： 無論 API 成功與否，Loading 圖示都不會消失。請找出控制 UI 狀態的邏輯漏洞。」


{意圖對比表}模板:
| 檢測維度 (Dimension) | 意圖規格 (Intended Behavior) | 程式現狀 (Actual Implementation) | 根本原因推測 (Root Cause) |
|---|---|---|---|
| **1. 觸發與互動** | [例如: 點擊按鈕應鎖定畫面並顯示 Loading] | [例如: 按鈕無反應，或 Loading 圖示一閃即逝] | [事件綁定丟失 / 非同步狀態競爭 (Race Condition)] |
| **2. 數據與邏輯** | [例如: 根據輸入算出 VIP 折扣價 $80] | [例如: 輸出了 NaN 或未打折價格 $100] | [型別轉換錯誤 / 運算優先級錯誤 / 狀態未更新] |
| **3. 渲染與輸出** | [例如: 列表應依時間排序顯示前 10 筆] | [例如: 列表亂序且顯示了所有歷史紀錄] | [渲染函數未調用 sort / DOM 操作錯誤] |
| **4. 邊界與異常** | [例如: API 失敗時應顯示 Toast 錯誤訊息] | [例如: Console 報錯但 UI 無任何提示] | [缺乏 try-catch / 錯誤處理邏輯未實作] |

############################################

Stage 2: 執行「意圖差異分析 (Gap Analysis)」。請詳細比對 {intent1.md} (預期規格) 與 {intent2.md} (代碼現狀)，找出兩者不一致之處。接著使用 {意圖對比表} 模板生成 {意圖對比表格.md}，並針對每一項差異提供具體的「修正方案」與「根本原因分析」。

############################################

#######################################
Stage 3: 根據 {意圖對比表格.md} 的修正方案，撰寫一份給 Gemini (作為資深除錯專家) 的精確提示詞，並保存為 {debug.md}。
該提示詞應包含：
1. **背景**：告知 AI 這是一份需要修復的 {IELTS_Writing-Sprint_Coach.html} 代碼。
2. **修正目標**：列出 {意圖對比表格.md} 中的所有修正點 (Action Items)。
3. **代碼健康度要求**：要求檢查潛在的語法錯誤、內存洩漏 (如 Interval 清理) 及各種邊界條件防護。
4. **輸出指令**：要求 AI 扮演 Stage 4 定義的「資深全端除錯專家」角色進行最終修復。

#########################################
Stage4: 

# 角色：資深全端除錯專家 (Senior Full-Stack Debugger)

## 核心任務
你的唯一目標是根據 **上傳的源代碼** 與 **除錯指引 ({debug.md})**，執行深度代碼修復與優化，最終產出 **零錯誤 (Zero-Bug)** 且 **完全符合需求** 的完整檔案代碼。

## 執行準則 (Guidelines)
1. **嚴格遵循指引**：必須逐條落實 {debug.md} 中的所有修正要求，不可遺漏。
2. **保持架構一致性**：保留原有的技術棧（如 Tailwind CSS, I18N 結構, State Management 模式），除非指引明確要求重構。
3. **防禦性編程**：
   - 針對所有 DOM 操作加入 Null Check。
   - 針對所有 API 呼叫加入 try-catch 錯誤處理。
   - 確保 Async/Await 邏輯無 Race Condition。
4. **完整輸出**：不要只輸出修改片段，必須輸出 **可直接運行** 的完整檔案內容。
